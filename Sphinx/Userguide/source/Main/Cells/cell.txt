
Though particle properties are continuous, collision events occur on a descretized lattice of cells. 
Each cell :math:`c` has a number of properties, which are interpretted as the discretized values of the macroscopic fields. 

.. _numberInCell:

Number density
==============

Each cell has an instantaneous number of MPCD particles :math:`N_c`. 
The average number :math:`\left\langle N_c \right\rangle` can be set in your input ``.json`` file for each fluid-species by setting the total number of particles of that species :math:`N_\text{tot}` in the input ``.json`` file

.. code-block:: console 

    "species":
    [
        {
            "POP":         100000
        }
    ]

and dividing by the number of accessible MPCD cells in the control volume. 
Alternatively, the number density for each species can be set explicitly  in the input ``.json`` file

.. code-block:: console 

    "species":
    [
        {
            "dens":         20
        }
    ]

This uses a Monte Carlo integration of the accessible volume to determine the total number of MPCD particles required to set *e.g.* :math:`\left\langle N_c \right\rangle = 20`.

.. _galilean:

Galilean invariance
===================

By discretizing the space into cells, **Galilean invariance** is broken [ihle2003]_. 
To understand why, consider a simulation of slow moving fluid particles (low temperatures). 
If the mean-free path of the molecules (see :ref:`Viscosity <chapter2>`) is much smaller than the cell size (:math:`\lambda \ll a`) then particles will often fail to travel far enough to leave the cell and may repeatedly exchange momentum with the same set of neighbours. 
Thus, the implicit assumption of underlying molecular chaos fails and the fixed lattice of cells causes the behaviour in a moving reference frame to be different than a fixed reference frame, since in the moving frame the set of neighbours would be different in each (\fig{fig:galInv}). 
However, Galilean invariance can be completely reestablished by shifting the cell grid each time step by a random vector. 
Galilean invariance is then remedied. 
Practically speaking, this is implemented by shifting all the fluid particles by the same vector whose components were chosen at random from the interval :math:`\left[-a/2,a/2\right]`. 

.. figure:: Cells/galileanInv.png
    :alt: Logo
    :scale: 30%
    :align: center

    Galilean invariance is restored by randomly shifting the lattice of MPCD cells. 

.. _angMom:

Conservation of angular momentum
================================

Multiple MPCD algorithm do not conserve angular momentum since they do not consider the positions of the fluid particles within the cell during a collision operation. 
In many advecting situations angular momentum does not play an essential role and so this fact is inconsequential [gotze07]_ [gotze11]_ [babu12]_. 
To conserving the angular momentum of the cell, the change in angular momentum relative to the centre of mass position during the collision event position is calculated. 
This angular momentum is then exactly cancelled out by giving the entire cell an appropriate angular velocity. 
For situations in which angular momentum conservation within the solvent plays an important role, appropriate collision operators should be chosen (see :ref:`Collision operators <chapter5>`).


.. _thermostat:

Thermostats
===================

**TYLER DO THIS TONIGHT**

.. rubric:: References

.. [ihle2003] Ihle & Kroll (2003), `Stochastic Rotation Dynamics. I. Formalism, Galilean Invariance, and Green-Kubo Relations <https://journals.aps.org/pre/abstract/10.1103/PhysRevE.67.066705>`_. *Physical Review E*, vol 67 (066705). 

.. [gotze07] Götze, Noguchi & Gompper (2007), `Relevance of angular momentum conservation in mesoscale hydrodynamics simulations <http://link.aps.org/abstract/PRE/v76/e046705>`_. *Physical Review E*, vol 76 (4).

.. [gotze11] Götze & Gompper (2011), `Dynamic self-assembly and directed flow of rotating colloids in microchannels <http://link.aps.org/doi/10.1103/PhysRevE.84.031404>`_. *Physical Review E*, vol 84 (3).

.. [babu12] Babu & Stark (2012), `Modeling the locomotion of the African trypanosome using multi-particle collision dynamics <http://stacks.iop.org/1367-2630/14/i=8/a=085012>`_. *New Journal of Physics*, vol 14 (8).
