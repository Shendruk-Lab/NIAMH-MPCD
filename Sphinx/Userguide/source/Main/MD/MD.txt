Molecular Dynamics (MD) numerically integrates the classical equations of motion for a large number of particles that interact via a set of pair potentials [Slater2009]_. It is a common approach to simulate polymer dynamics. Polymer molecules are composed of a large number of equal repeat units called monomers which are connected linearly by bonds.

Dry sytsem 
==========

The term **dry** indicates that there are no hydrodynamic interactions included. Moreover, in our version of the MD solver the dynamics of the chain monomers is determined by Newtons’ equations of motion (No noise). These equations are integrated using the velocity Verlet algorithm.  The standard implementation scheme of this algorithm is to 

#. calculate :math:`{\vec v}(t+1/2 {\Delta}t) = {\vec v}(t) + 1/2 {\vec a}(t){\Delta}t`.

#. calculate :math:`{\vec x}(t+{\Delta}t) = {\vec x}(t) + {\vec v}(t+1/2{\Delta}t){\Delta}t`.

#. derive :math:`{\vec a}(t+{\Delta}t)` from the interaction potentials using :math:`{\vec x}(t+{\Delta}t)`.

#. calculate :math:`{\vec v}(t+{\Delta}t) = {\vec v}(t+1/2{\Delta}t) + 1/2 {\vec a}(t+{\Delta}t) {\Delta}t`.

This algorithm gives the particle’s velocity and position at the next time step using the interaction forces from the potentials as :math:`f = - \nabla U(r_{ij})` for pairs of particles that are separated by a distance :math:`r_{ij}`. The most common pair potentials for simulating polymers are 

- **Lennard-Jones (LJ) Potential**, :math:`U_{\text{LJ}}`: The interaction between two free, uncharged molecules (respectively labelled :math:`i` and :math:`j`) 

.. math::

    U_{\text{LJ}}(r_{ij}) = 4\epsilon \left[ \left(\frac{\sigma}{r_{ij}}\right)^{12} - \left(\frac{\sigma}{r_{ij}}\right)^6 \right],

where :math:`r_{ij}` is the separation between two monomers, :math:`\epsilon` is the well depth and :math:`\sigma` is the effective diameter of the pair of MD particles.

- **Weeks-Chandler-Andersen (WCA) Potential**, :math:`U_{\text{WCA}}`: A purely repulsive, truncated form   of the LJ potential commonly used as a coarse-grained interaction. The LJ potential is shifted and truncated at its minimum value so that it ends smoothly at a distance :math:`r_c`. The WCA potential can be written as

.. math::

    U{\text{WCA}}(r_{ij}) = 4\epsilon
    \begin{cases}
         \left(\frac{\sigma}{r_{ij}}\right)^{12} - \left(\frac{\sigma}{r_{ij}}\right)^6
        + \frac{1}{4},
        & r_{ij}<r_c\\
        0,
        & r_{ij}>r_c
    \end{cases}


where :math:`r_c = \sqrt[6]{2}\sigma`.

- **Finitely Extensible Bonds**, :math:`U_{\text{FENE}}`: In any coarse-grained model of a polymer, adjacent MD beads must be connected together to form a chain of monomers. The use of harmonic potentials can lead to unphysical bond stretching effects. For this reason, a finitely extensible force with a hard limit on the bond length is utilized [Wu2014]_. The most common choice is the finitely extensible nonlinear elastic potential (FENE):

.. math::

    U_{\text{FENE}}(r_{ij})
    = -\frac{k_{\text{FENE}}}{2} {r_0}^2 \ln 
    \left( 1-\frac{{r_{ij}}^2}{{r_0}^2} \right),

where :math:`k_{\text{FENE}}` is a spring constant representing the stiffness of the bond in response to stretching and :math:`r_0` is the equilibrium length of the bonds.

.. _Bending Potential:

- **Bond Bending Potential**, :math:`U_{\text{Bend}}`: This potential captures the stiffness of the polymer in response to bending force. Since the simulations are coarse-grained these are not intended to represent chemical bending potentials but can give polymer chains microscopic characteristics such as correlations along the back-bone (a non-zero persistence length). There are several bending potentials including angular harmonic, cosine harmonic or cosine expansion [Bulacu2013]_. For instance angular harmonic is given by

.. math::

    U_{\text{Bend}}(\theta _{ijk}) = \frac{k_{\text {Bend}}}{2} (\theta _{ijk} - \vartheta)^2.

The angle :math:`\theta_{ijk}` is the angle created by three consecutive monomers :math:`i, j` and :math:`k` and :math:`\vartheta` is the equilibrium angle. The parameter to modulate the bend stiffness is :math:`k_{\text{Bend}}` .

- **Coulombic Potential**, :math:`U_{\text{Coul}}`: The bare electrostatic interaction between pairs of particles is given by the Coulombic potential

.. math::

    U_{\text{Coul}}(r_{ij}) = \frac{1}{4 \pi \epsilon_0 \epsilon_r} \frac{Q_i Q_j}{r_{ij}}

where :math:`Q_i` and :math:`Q_j` are the *effective* charges on each particle after charge reduction due
to counterion condensation. For mesoscopic simulations, :math:`\epsilon_0 \epsilon_r` is an effective dielectric constant that includes screening effects due to the medium. Condensation effects can be encapsulated in the Bjerum length

.. math::

        \lambda_B = \frac {e^2}{4 \pi \epsilon_0 \epsilon_r K_BT}


The Bjerum length is the distance beyond which thermal energy is greater than electrostatic energy. In terms of the Bjerum length, Coulombic interactions can be written

.. math::

    U_{\text{Coul}}(r_{ij}) = K_BT \frac{Q_i Q_j}{r_{ij}} \frac{\lambda_B}{r_{ij}}

The Coulombic interactions are long-range scaling like :math:`∼ r_{ij}^{−1}`. The long-range contributions are important and for this reason, inclusion of electrostatic effects can be computationally expensive. However, in a solvent electrostatic interactions are screened by the electric double layer and so it is not always necessary to use :math:`U_{\text{Coul}}`. Often a much shorter-ranged electrostatic interaction will suffice.

- **Debye-Huckel Potential**, :math:`U_{\text{DH}}`: The electrostatic interactions are typically screened. The Debye-Huckel potential is the approximation for the electrostatic potential of a charged sphere. This electric potential is given in terms of the zeta-potential. Since MD monomers do not conveniently have a zeta-potential could be replaced with the effective charge on the :math:`i_{th}` monomer (of radius :math:`r = \frac {\sigma}{2}` ) \ie. :math:`Q_{\text{eff}} = 4 \pi \epsilon_0 \epsilon_r r \zeta (1+r/\lambda_{\text{D}})`. The Debye length, :math:`\lambda_{\text{D}}`, is the length scale beyond which Coulombic interactions are screened by the distribution of counterions. Then the potential between two spheres of effective charge :math:`{Q_i}^{eff}` and :math:`{Q_j}^{eff}` in the Huckel limit of :math:`\sigma/\lambda_{\text{D}} \ll 1` becomes

.. math::

    U_{\text{Coul}}(r_{ij}) \approx K_BT \frac{Q_i Q_j}{e^2} \frac{\lambda_B}{r_{ij}} \exp(\frac{-r_{ij}}{\lambda_{\text{D}}})


Wet system
==========

Isotropic fluid
---------------

The dynamical behavior of macromolecules in solution is strongly affected or even dominated by hydrodynamic interactions. Mesoscale hydrodynamic simulations can be used to introduce hydrodynamic interactions to molecular dynamic (MD) simulations and consequently to provide a full characterization of the polymer dynamics [Holm2008]_. This coupling to the fluid can be done in two ways. Either the MD beads can be included in the MPCD algorithm or the MPCD particles can be included in the MD calculations.

.. list-table:: 
    :header-rows: 0
    :widths: 50 50
    :align: center

    * - .. figure:: MD/MDinMPCD.png
            :width: 95%
            :align: center

      - .. figure:: MD/MPCDinMD.png
            :width: 95%
            :align: center

    * - :ref:`MD-in-MPCD Coupling <MD-in-MPCD Coupling>`

      - :ref:`MPCD-in-MD Coupling <MPCD-in-MD Coupling>`

.. _MD-in-MPCD Coupling:

MD-in-MPCD Coupling
^^^^^^^^^^^^^^^^^^^

The MD monomers can be included in the MPCD collision operations. This scheme is referred to as MD-in-MPCD coupling. In the MD-in-MPCD scheme the MD algorithm integrates the MD monomer trajectories over some number of MD time-steps :math:`N_{\text{MD}}`. In a sense, during this period the MD simulation occurs in a vacuum. After this the program exits the MD portion of the algorithm and enters the MPCD side. The MD beads are ported into the MPCD algorithm as point particles and are included in the collision operation. In this way, the MD beads exchange momentum with the fluid. The MPCD particles perform the streaming step (the MD particles do not) before the MD algorithm is reinitiated for another :math:`N_{\text{MD}}` MD time-steps.

Values of :math:`N_{\text{MD}}` are typically large (on the order of 10 although smaller values have been used in the literature). This separation of time scales ensures that the momentum transferred to the polymer during the collision step is well distributed throughout the chain.

.. _MPCD-in-MD Coupling:

MPCD-in-MD Coupling
^^^^^^^^^^^^^^^^^^^

The second coupling scheme is more accurately described as a hybrid MPCD/MD approach. In the MPCD-in-MD coupling scheme MPCD solvent particles are included in the MD integrator. In the MD portion of the program the monomers interact with one another (monomer-monomer interactions) and also with the solvent fluid particles (monomer-solvent interactions) but the solvent particles do not interact with each other (no solvent-solvent interactions). In this implementation the MPCD fluid particles are cast as MD beads with the same properties as the monomers but this is not necessary. If desired, the program could be altered such that the MPCD particles would be cast as MD beads with different pair potentials than the monomers. The position and velocity of the all MPCD fluid particles is updated in time by the Verlet algorithm. After :math:`N_{\text{MD}}` MD time-steps, the MD integrator is exited and the MPCD portion of the program is performed. MPCD fluid particles are binned into cells and exchange momentum by the MPCD collision operator. Since their positions are updated in the MD portion of the program, they do not stream.

The number of MD steps between an MPCD step can be much smaller that in the MD-in-MPCD scheme.

In both coupling schemes, the MD particles are typically given a mass :math:`m_{\text{MD}}` that is larger than the MPCD particles’ mass in order to achieve efficient coupling.


Nematic fluid
-------------

When it comes to a nematic background, the orientational order of the fluid also plays an important role. A polymer embedded in an isotropic fluid is just coupled to the flow field through exchanging momentum. But in the case of a nematic fluid the backbone of the polymer can be coupled to the orientation field and the following potential captures this coupling in our model

.. _Coupling Potential:

- **Nematic Coupling Potential**, :math:`U_{\text{Nem}}`: This potential aligns each bond of the polymer connecting two consecutive monomers with the local nematic orientation. it works similarly to the :ref:`Bond Bending Potential <Bending Potential>` with one difference. The angle in this case is the angle beween the bond and the local nematic orientation.

.. math::

    U_{\text{Nem}}(\theta _{ijk}) = \frac{k_{\text {Nem}}}{2} (\theta - \vartheta)^2.

where :math:`\vartheta` is the equilibrium angle which in this case is **zero**. The parameter to modulate the alignment strength is :math:`k_{\text{Nem}}`.

.. list-table:: 
    :header-rows: 0
    :widths: 50
    :align: center

    * - .. figure:: MD/coupling.png
            :width: 40%
            :align: center
    * - :ref:`Nematic Coupling Potential <Coupling Potential>`