<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Hard-coded options" href="../HardCoded/HardCoded.html" /><link rel="prev" title="Tutorials" href="../Tutorials/Tutorials.html" />

    <link rel="shortcut icon" href="../_static/niamh-logo.png"/><!-- Generated with Sphinx 5.3.0 and Furo 2023.03.27 -->
        <title>Usage - NIAMH-MPCD documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=fad236701ea90a88636c2a8c73b44ae642ed2a53" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">NIAMH-MPCD  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/niamh-logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">NIAMH-MPCD  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Summary/Summary.html">Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Install/Install.html">Installation guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Install/Run.html">Run guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Input/inputFiles.html">Input guide</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Tutorials/Tutorials.html">Tutorials</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../HardCoded/HardCoded.html">Hard-coded options</a></li>
<li class="toctree-l1"><a class="reference internal" href="ExtraTheory.html">Additional theoretical background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Outputs/Outputs.html">Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Analysis/Analysis.html">Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../DeveloperGuide/DeveloperGuide.html">Developer’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Glossary/Glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../References/References.html">Bibliography</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="usage">
<span id="usagechapter"></span><h1>Usage<a class="headerlink" href="#usage" title="Permalink to this heading">#</a></h1>
<p>NIAMH-MPCD sets its particle properties, cell properties, initialization, boundary conditions, etc. through json input files (see the <a class="reference internal" href="../Install/Run.html#runguide"><span class="std std-ref">Input guide</span></a> for command line arguments to provide input files to the code and the <a class="reference internal" href="../Input/inputFiles.html#inputguide"><span class="std std-ref">Input json files</span></a> section for details on the json format).
The <a class="reference internal" href="../Tutorials/Tutorials.html#tutorials"><span class="std std-ref">Tutorials</span></a> provide different example input files for specific simulations.
The following sections provide an overview of the different input parameters in these files.</p>
<dl class="simple">
<dt>Broadly speaking, the NIAMH-MPCD code has the following components:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#chaptersimulations"><span class="std std-ref">System-wide parameters</span></a></p></li>
<li><p><a class="reference internal" href="#chapterparticles"><span class="std std-ref">Particle properties</span></a></p></li>
<li><p><a class="reference internal" href="#chaptercell"><span class="std std-ref">Cell properties</span></a></p></li>
<li><p><a class="reference internal" href="#chaptercollop"><span class="std std-ref">Collision operators</span></a></p></li>
<li><p><a class="reference internal" href="#chapterbc"><span class="std std-ref">Boundary conditions</span></a></p></li>
<li><p><a class="reference internal" href="#extraschapter"><span class="std std-ref">Extra options</span></a></p></li>
</ul>
</dd>
</dl>
<section id="system-properties">
<span id="chaptersimulations"></span><h2>System properties<a class="headerlink" href="#system-properties" title="Permalink to this heading">#</a></h2>
<p>All NIAMH-MPCD simulations have the following properties and they should be initialized in the input <code class="docutils literal notranslate"><span class="pre">.json</span></code> file.</p>
<section id="domain">
<span id="systemdomain"></span><h3>Domain<a class="headerlink" href="#domain" title="Permalink to this heading">#</a></h3>
<p>The system domain is set by giving an array, given as [X, Y] or [X, Y, Z].
If the array has a length of two, the system is assumed to be 2D. If it has a length of three, it is 3D. Other lengths are not permitted. A 2D system corresponds to a [30,30,1] domain.</p>
<p>Setting the domain does <strong>not</strong> set the boundary conditions. That must be done separately as explained in the <a class="reference internal" href="#chapterbc"><span class="std std-ref">BC</span></a> section.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&quot;domain&quot;:   [&lt;value_1&gt;,&lt;value_2&gt;,&lt;value_3&gt;],</span>
</pre></div>
</div>
</section>
<section id="thermal-energy">
<span id="kbt"></span><h3>Thermal energy<a class="headerlink" href="#thermal-energy" title="Permalink to this heading">#</a></h3>
<p>Most MPCD algorithms are thermostatted and those that conserve energy are initialized by the thermal energy <span class="math notranslate nohighlight">\(k_B T\)</span>, where <span class="math notranslate nohighlight">\(k_B\)</span> is the Boltzmann constant and <span class="math notranslate nohighlight">\(T\)</span> is the temperature. To set it, add the following to your input <code class="docutils literal notranslate"><span class="pre">.json</span></code> file:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>&quot;kbt&quot;:   &lt;value&gt;,
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The default value = 1 and it should be <strong>always</strong> be 1 since it sets the energy scale (see <a class="reference internal" href="../Algorithm/Background.html#set-values"><span class="std std-ref">units</span></a>).</p>
</div>
</section>
<section id="timestep">
<span id="id1"></span><h3>Timestep<a class="headerlink" href="#timestep" title="Permalink to this heading">#</a></h3>
<p>The MPCD algorithm iterates streaming and collision operations over discrete timesteps <span class="math notranslate nohighlight">\(\delta t\)</span>. The timestep <span class="math notranslate nohighlight">\(\delta t\)</span> does <strong>not</strong> define the units of time (see <a class="reference internal" href="../Algorithm/Background.html#derivedunits"><span class="std std-ref">Derived units</span></a>) and so it can take any value. To set it, add the following to your input <code class="docutils literal notranslate"><span class="pre">.json</span></code> file:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>&quot;dt&quot;:   &lt;value&gt;,
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The default value <span class="math notranslate nohighlight">\(\delta t= 0.1\)</span>. Typically values less than or equal to 1 are best. Decreasing the timestep increases the viscosity (see <a class="reference internal" href="ExtraTheory.html#viscositysection"><span class="std std-ref">Transport coefficients</span></a>).</p>
</div>
</section>
<section id="simulation-steps">
<span id="simsteps"></span><h3>Simulation steps<a class="headerlink" href="#simulation-steps" title="Permalink to this heading">#</a></h3>
<p>The MPCD code iterates for a number of time steps. To set the duration of a simulation, add the following to your input <code class="docutils literal notranslate"><span class="pre">.json</span></code> file:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>&quot;simSteps&quot;:   &lt;value&gt;,
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Like all times in the <code class="docutils literal notranslate"><span class="pre">input.json</span></code> file is in number of iterations <span class="math notranslate nohighlight">\(\delta t\)</span>, <strong>not</strong> simulation units of time <span class="math notranslate nohighlight">\([\tau]\)</span>.</p>
</div>
</section>
<section id="warmup-steps">
<span id="warmup"></span><h3>Warmup steps<a class="headerlink" href="#warmup-steps" title="Permalink to this heading">#</a></h3>
<p>The MPCD code can iterate for a number of time steps prior to writing out data. To set the duration of this warmup phase of the simulation, add the following to your input <code class="docutils literal notranslate"><span class="pre">.json</span></code> file:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>&quot;warmUp&quot;:   &lt;value&gt;,
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">warmup</span></code> duration is in addition to the <code class="docutils literal notranslate"><span class="pre">simSteps</span></code> duration.</p>
</div>
</section>
<section id="random-number-seed">
<span id="seed"></span><h3>Random number seed<a class="headerlink" href="#random-number-seed" title="Permalink to this heading">#</a></h3>
<p>The MPCD algorithm relies on generating many random numbers. The seed for the random number generator (see <span class="xref std std-ref">&lt;&gt;</span>) can be set by adding the following to your input <code class="docutils literal notranslate"><span class="pre">.json</span></code> file:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>&quot;seed&quot;:   &lt;value&gt;,
</pre></div>
</div>
<p>If the seed is set to zero (which is the default) then a pseudorandom seed is generated through a combination of microseconds on the clock and processor task ID. The seed is outputted in <code class="docutils literal notranslate"><span class="pre">synopsis.dat</span></code> (see <a class="reference internal" href="../Outputs/Outputs.html#id1"><span class="std std-ref">Outputs</span></a>). If the <code class="docutils literal notranslate"><span class="pre">seed</span></code> is set to -1, the simulation starts from a checkpoint.</p>
</section>
<section id="terminal-output">
<span id="debugout"></span><h3>Terminal output<a class="headerlink" href="#terminal-output" title="Permalink to this heading">#</a></h3>
<p>The verbosity of the information that NIAMH-MPCD writes to the terminal can be controlled.  To set the verbosity, add the following to your input <code class="docutils literal notranslate"><span class="pre">.json</span></code> file:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&quot;debugOut&quot;:   &lt;value&gt;,</span>
</pre></div>
</div>
<dl class="simple">
<dt>Common choices are:</dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> Outputs nothing but acknowledgement that the simulation has started and ended. This Debug/verbosity level should be used for data collection runs.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> Only outputs warnings.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">2</span></code> Outputs initialisation information.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">3</span></code> Outputs an acknowledgement of each eteration step.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">4</span></code> Gives a title to some methods and outputs them when called.</p></li>
<li><p>Higher numbers are specific to certain aspects of the code and may be useful for debugging. Please see <code class="docutils literal notranslate"><span class="pre">mpcd/headers/definitions.h</span></code> for a complete list.</p></li>
</ul>
</dd>
</dl>
</section>
</section>
<section id="mpcd-particle-properties">
<span id="chapterparticles"></span><h2>MPCD particle properties<a class="headerlink" href="#mpcd-particle-properties" title="Permalink to this heading">#</a></h2>
<p>MPCD fluid is made of point-like particles and based on the fluid type they have different properties.
Fluid particle properties are typically set within the <code class="docutils literal notranslate"><span class="pre">&quot;species&quot;</span></code> array (see <span class="xref std std-ref">Species tag table</span>).</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>&quot;species&quot;:
[
    {
        &quot;comment&quot;: &quot;MPCD species 1&quot;,
        &quot;&lt;tag&gt;&quot;:  &lt;value&gt;,
        ...,
        ...
    },
    {
        &quot;comment&quot;: &quot;MPCD species 2&quot;,
        &quot;&lt;tag&gt;&quot;:  &lt;value&gt;,
        ...,
        ...
    }
],
</pre></div>
</div>
<section id="isotropic-fluid">
<h3>Isotropic fluid<a class="headerlink" href="#isotropic-fluid" title="Permalink to this heading">#</a></h3>
<p>Any fluid solved with MPCD particles has the following properties and they should be initialized in the input <code class="docutils literal notranslate"><span class="pre">.json</span></code> file within a <code class="docutils literal notranslate"><span class="pre">&quot;species&quot;</span></code> array.</p>
<section id="position">
<span id="id2"></span><h4>Position<a class="headerlink" href="#position" title="Permalink to this heading">#</a></h4>
<p>Each particle has a position vector, <span class="math notranslate nohighlight">\({\vec x}_i\)</span>, pointing to its position in the control volume.</p>
<p><code class="docutils literal notranslate"><span class="pre">&quot;qdist&quot;</span></code> specifies how the position of this fluid-species’ particles are initialised. The available options are to:</p>
<ul>
<li><p>place the particles randomly and freely within the control volume.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;qdist&quot;</span><span class="p">:</span><span class="w">         </span><span class="mi">0</span><span class="p">,</span>
</pre></div>
</div>
</li>
<li><p>read the particles’ positions from a file.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;qdist&quot;</span><span class="p">:</span><span class="w">         </span><span class="mi">1</span><span class="p">,</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The default value is 0.</p>
</div>
</section>
<section id="velocity">
<span id="id3"></span><h4>Velocity<a class="headerlink" href="#velocity" title="Permalink to this heading">#</a></h4>
<p>Each particle has a velocity vector, <span class="math notranslate nohighlight">\({\vec v}_i\)</span>. Available options can be found in the <span class="xref std std-ref">velocity initialization</span>.</p>
<p><code class="docutils literal notranslate"><span class="pre">&quot;vdist&quot;</span></code> specifies how the velocity of this fluid-species’ particles is initialised. The available options are to:</p>
<ul>
<li><p>draw the velocity from an uniformly random distribution. The width of the uniform distribution is <span class="math notranslate nohighlight">\((2 k_\text{B}T/m)^{1/2}\)</span> for each component.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;vdist&quot;</span><span class="p">:</span><span class="w">         </span><span class="mi">0</span><span class="p">,</span>
</pre></div>
</div>
</li>
<li><p>read the particles’ velocities from a file.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;vdist&quot;</span><span class="p">:</span><span class="w">         </span><span class="mi">1</span><span class="p">,</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This option is not currently operational.</p>
</div>
</li>
<li><p>give all the particles the same initial speed but in different directions.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;vdist&quot;</span><span class="p">:</span><span class="w">         </span><span class="mi">2</span><span class="p">,</span>
</pre></div>
</div>
</li>
<li><p>give all the particles the same initial speed along each axis in either direction.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;vdist&quot;</span><span class="p">:</span><span class="w">         </span><span class="mi">3</span><span class="p">,</span>
</pre></div>
</div>
</li>
<li><p>draw the particles’ velocity from a Gaussian distribution scaled by <span class="math notranslate nohighlight">\((k_\text{B}T/m)^{1/2}\)</span> for each component of the velocity.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;vdist&quot;</span><span class="p">:</span><span class="w">         </span><span class="mi">4</span><span class="p">,</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The default value is 0.</p>
</div>
</section>
<section id="mass">
<span id="id4"></span><h4>Mass<a class="headerlink" href="#mass" title="Permalink to this heading">#</a></h4>
<p>Each MPCD particle is assigned a mass specifing its contribution in the velocity collision step, when its momentum is exchanged with other particles belonging to the same cell. To set it, add the following to your input <code class="docutils literal notranslate"><span class="pre">.json</span></code> file within a <code class="docutils literal notranslate"><span class="pre">&quot;species&quot;</span></code>:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>&quot;mass&quot;:   &lt;value&gt;,
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The default value = 1 and it should be <strong>always</strong> be 1 for at least one fluid-species since it sets the mass scale (see <a class="reference internal" href="../Algorithm/Background.html#set-values"><span class="std std-ref">units</span></a>).</p>
</div>
</section>
<section id="population">
<span id="id5"></span><h4>Population<a class="headerlink" href="#population" title="Permalink to this heading">#</a></h4>
<p>It is the total population of the particles <span class="math notranslate nohighlight">\(N_\text{tot}\)</span> for each fluid-species. For more details check <span class="xref std std-ref">population initialization</span> .</p>
<p>To set it, add the following to your input <code class="docutils literal notranslate"><span class="pre">.json</span></code> file within a <code class="docutils literal notranslate"><span class="pre">&quot;species&quot;</span></code>:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>&quot;pop&quot;:   &lt;value&gt;,
</pre></div>
</div>
<p>The total population sets the average number <span class="math notranslate nohighlight">\(\left\langle N_c \right\rangle\)</span> of particles per cell for each fluid-species and dividing by the number of accessible MPCD cells in the control volume sets the number density <span class="math notranslate nohighlight">\(\left\langle n_c \right\rangle\)</span>. If all fluid-species particles have the same <a class="reference internal" href="../Algorithm/Background.html#set-values"><span class="std std-ref">unit mass</span></a> then the number density is equivalent to the mass density <span class="math notranslate nohighlight">\(\rho_c(t)\)</span>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">&quot;pop&quot;</span></code> can be overriden with <code class="docutils literal notranslate"><span class="pre">&quot;dens&quot;</span></code>.</p>
</div>
</section>
<section id="number-density">
<span id="density"></span><h4>Number density<a class="headerlink" href="#number-density" title="Permalink to this heading">#</a></h4>
<p>The population <code class="docutils literal notranslate"><span class="pre">&quot;pop&quot;</span></code> can be overriden for a given fluid-species population to correspond by setting the number density <span class="math notranslate nohighlight">\(\left\langle n_c \right\rangle\)</span> directly. This override sets the population to the accessible volume <span class="math notranslate nohighlight">\(V\)</span> times the density,</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[N_\text{tot} = V \left\langle n_c \right\rangle .\]</div>
</div>
<p>The volume <span class="math notranslate nohighlight">\(V\)</span> is the volume accessible to this particular species (i.e. volume of the domain, minus any excluded regions due to BCs).
Determining the accessible volume is done via a Monte Carlo integrator.
Because it uses Monte Carlo, the actually integer population <span class="math notranslate nohighlight">\(N_\text{tot}\)</span> of different realizations may vary minutely between runs.</p>
<p>To set the number density, add the following to your input <code class="docutils literal notranslate"><span class="pre">.json</span></code> file within a <code class="docutils literal notranslate"><span class="pre">&quot;species&quot;</span></code>:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>&quot;dens&quot;:   &lt;value&gt;,
</pre></div>
</div>
</section>
</section>
<section id="nematic-fluid">
<span id="nematicparticles"></span><h3>Nematic fluid<a class="headerlink" href="#nematic-fluid" title="Permalink to this heading">#</a></h3>
<p>When simulating a fluctuating nematic liquid crystals, the MPCD particles must be given additional properties due to their nematic orientational symmetry. In that case, they have the following properties and they should be initialized in the input <code class="docutils literal notranslate"><span class="pre">.json</span></code> file.</p>
<p>Set whether or not the fluid is isotropic or nematic using the <code class="docutils literal notranslate"><span class="pre">&quot;lc&quot;</span></code> tag <strong>outside</strong> of the <code class="docutils literal notranslate"><span class="pre">&quot;species&quot;</span></code> array:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>&quot;lc&quot;: &lt;value&gt;,
</pre></div>
</div>
<ul class="simple">
<li><p>Isotropic fluid</p></li>
</ul>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;lc&quot;</span><span class="p">:</span><span class="w">         </span><span class="mi">0</span><span class="p">,</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Nematic fluid using local orientational order</p></li>
</ul>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;lc&quot;</span><span class="p">:</span><span class="w">         </span><span class="mi">1</span><span class="p">,</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Nematic fluid using global orientational order</p></li>
</ul>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;lc&quot;</span><span class="p">:</span><span class="w">         </span><span class="mi">2</span><span class="p">,</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The option to use global orientation for simulating nematics amounts to using a mean field approximation in the collision operation. The local version should be prefered (i.e. <code class="docutils literal notranslate"><span class="pre">&quot;lc&quot;:</span> <span class="pre">1</span></code>).</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All other nematic particle parameters are fluid-species specific and are set in the <code class="docutils literal notranslate"><span class="pre">&quot;species&quot;</span></code> array.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The default value is 0.</p>
</div>
<section id="orientation">
<span id="orientationparticles"></span><h4>Orientation<a class="headerlink" href="#orientation" title="Permalink to this heading">#</a></h4>
<p>Each MPCD particle <span class="math notranslate nohighlight">\(i\)</span> is assigned an orientation <span class="math notranslate nohighlight">\({\vec u}_i\)</span>. Each fluid-species of MPCD particle must have its orientations initialized, which is specified by <code class="docutils literal notranslate"><span class="pre">&quot;odist&quot;</span></code>. The available options are to:</p>
<ul>
<li><p>isotropically</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;odist&quot;</span><span class="p">:</span><span class="w">         </span><span class="mi">0</span><span class="p">,</span>
</pre></div>
</div>
<ul class="simple">
<li><p>3D: Sample the z component on <span class="math notranslate nohighlight">\([{\cos(\pi)}, 1]\)</span> and then sample the azimuthal angle, <span class="math notranslate nohighlight">\({\phi}\)</span> on <span class="math notranslate nohighlight">\([0, 2{\pi})\)</span>.</p></li>
<li><p>2D: Simply sample the azimuthal angle homogeneously.</p></li>
<li><p>1D: Checks if <span class="math notranslate nohighlight">\({\cos(\phi)}\)</span> would be parallel or anti-parallel, returning +1.0 or -1.0.</p></li>
</ul>
</li>
<li><p>align all particles along X axis</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;odist&quot;</span><span class="p">:</span><span class="w">         </span><span class="mi">1</span><span class="p">,</span>
</pre></div>
</div>
</li>
<li><p>align all particles along Y axis</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;odist&quot;</span><span class="p">:</span><span class="w">         </span><span class="mi">2</span><span class="p">,</span>
</pre></div>
</div>
</li>
<li><p>align all particles along Z axis</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;odist&quot;</span><span class="p">:</span><span class="w">         </span><span class="mi">3</span><span class="p">,</span>
</pre></div>
</div>
</li>
<li><p>align all particles along 45 degree angle</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;odist&quot;</span><span class="p">:</span><span class="w">         </span><span class="mi">4</span><span class="p">,</span>
</pre></div>
</div>
</li>
<li><p>align all particles randomly within XY axis</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;odist&quot;</span><span class="p">:</span><span class="w">         </span><span class="mi">5</span><span class="p">,</span>
</pre></div>
</div>
</li>
<li><p>align all particles randomly within XZ axis</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;odist&quot;</span><span class="p">:</span><span class="w">         </span><span class="mi">6</span><span class="p">,</span>
</pre></div>
</div>
</li>
<li><p>align all particles randomly within YZ axis</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;odist&quot;</span><span class="p">:</span><span class="w">         </span><span class="mi">7</span><span class="p">,</span>
</pre></div>
</div>
</li>
<li><p>align all particles in the direction of origin towards positive right hand corner of any cartesian plan</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;odist&quot;</span><span class="p">:</span><span class="w">         </span><span class="mi">8</span><span class="p">,</span>
</pre></div>
</div>
</li>
<li><p>align all particles in the direction of two oppositely charged defects</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;odist&quot;</span><span class="p">:</span><span class="w">         </span><span class="mi">9</span><span class="p">,</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The default value is 2.</p>
</div>
</section>
<section id="rotational-friction-coefficient">
<span id="rotationfriction"></span><h4>Rotational friction coefficient<a class="headerlink" href="#rotational-friction-coefficient" title="Permalink to this heading">#</a></h4>
<p>Nematic MPCD particles are assigned a rotational friction coefficient so that there is no angular acceleration between collision events (just as the <a class="reference internal" href="../Algorithm/Background.html#streaming"><span class="std std-ref">isotropic MPCD algorithm does not include any translational acceleration</span></a>). The angular drift velocity <span class="math notranslate nohighlight">\({\omega} = d{\theta}/dt\)</span> in response to an external torque <span class="math notranslate nohighlight">\({\Gamma}\)</span> is s given by <span class="math notranslate nohighlight">\({\omega} = {\Gamma}/f_r\)</span> where <span class="math notranslate nohighlight">\(f_r\)</span> is the rotational drag coefficient.</p>
<p>To set it, add the following to your input <code class="docutils literal notranslate"><span class="pre">.json</span></code> file:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>&quot;rfc&quot;:    &lt;value&gt;,
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The default value is 0.01.</p>
</div>
</section>
<section id="tumbling-parameter">
<span id="tumbling"></span><h4>Tumbling parameter<a class="headerlink" href="#tumbling-parameter" title="Permalink to this heading">#</a></h4>
<p>Coupling between the director and fluid flow is crucial for reproducing nematohydrodynamics since flows can rotate the nematogens just as it can rotate any rodlike, or elongated object. The director profile is not only rotated by the flow, but can also align when subject to a shear. The orientational response of individual particles obeys the Jeffery equation and the tumbling parameter <span class="math notranslate nohighlight">\(\lambda\)</span> specifiec how the nematogens respond to a shear. If <span class="math notranslate nohighlight">\(\lambda \geq 1\)</span>, the director field aligns with the flow—such LCs are known as “flow-aligning” . If <span class="math notranslate nohighlight">\(\lambda &lt; 1\)</span>, the director field rotates in the flow continuously—such LCs are known as “flow-tumbling”.</p>
<p>To set the tumbling parameter, add the following to your input <code class="docutils literal notranslate"><span class="pre">.json</span></code> file:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>&quot;tumble&quot;:    &lt;value&gt;,
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This sets the <strong>bare</strong> tumbling parameter. The emergent hydrodynamic tumbling parameter of the resulting fluid is</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\lambda^\prime = \lambda \frac{15 S + 48 S_4+ 42}{105S} ,\]</div>
</div>
<p>where <span class="math notranslate nohighlight">\(S\)</span> is the system averaged scalar order parameter and <span class="math notranslate nohighlight">\(S_4\)</span> is the fourth moment of the orientation probability distribution <a class="reference internal" href="../References/References.html#shendruk2015" id="id6"><span>[Shendruk2015]</span></a> <a class="reference internal" href="../References/References.html#archerlarson1995" id="id7"><span>[ArcherLarson1995]</span></a>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The default value is 2.</p>
</div>
</section>
<section id="shear-susceptibility">
<span id="shearsus"></span><h4>Shear susceptibility<a class="headerlink" href="#shear-susceptibility" title="Permalink to this heading">#</a></h4>
<p>The nematic MPCD algorithm includes a susceptibility of the director to shear <span class="math notranslate nohighlight">\(\chi_\text{HI}\)</span>. Theoretically, it is always 1 but practically a heuristic shear coupling coefficient should exit, that tunes the alignment relaxation time relative to <span class="math notranslate nohighlight">\({\delta} t\)</span>. When the shear coupling coefficient is set to <span class="math notranslate nohighlight">\(\chi_\text{HI}=0\)</span> there is no coupling of the director to the velocity field.</p>
<p>To set it, add the following to your input <code class="docutils literal notranslate"><span class="pre">.json</span></code> file:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>&quot;shearSusc&quot;:    &lt;value&gt;,
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The default value is 0.5.</p>
</div>
</section>
<section id="magnetic-susceptibility">
<span id="magsus"></span><h4>Magnetic susceptibility<a class="headerlink" href="#magnetic-susceptibility" title="Permalink to this heading">#</a></h4>
<p>A <a class="reference internal" href="#magfield"><span class="std std-ref">magnetic field :math:`{vec H}`</span></a> can be applied to the system, which could bias the MPCD particle orientations. The susceptibility of the director to a magnetic field <span class="math notranslate nohighlight">\(\chi\)</span> controls the rotational response of the particles. The magnitude of the torque applied to the nematogen is proportional to <span class="math notranslate nohighlight">\(\chi ({\vec u}_i {\cdot} {\vec H})\)</span> in which the <span class="math notranslate nohighlight">\({\vec u}_i\)</span> is each particle’s orientation.</p>
<p>To set it, add the following to your input <code class="docutils literal notranslate"><span class="pre">.json</span></code> file:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>&quot;magSusc&quot;:    &lt;value&gt;,
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The default value is 0.001.</p>
</div>
</section>
<section id="length">
<span id="id8"></span><h4>Length<a class="headerlink" href="#length" title="Permalink to this heading">#</a></h4>
<p>Despite being “point-like”, nematic MPCD particles have an orientation and also an effective length. The effective length is necessary to couple the torque on MPCD particle into force on boundaries.</p>
<p>If <span class="math notranslate nohighlight">\({\vec \Gamma}\)</span> is the torque on MPCD particle, <span class="math notranslate nohighlight">\({\vec \Gamma}  = {\vec r} {\times} {\vec F}\)</span>,</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{split}{\vec r} {\times} {\vec \Gamma} &amp;= {\vec r} {\times} ({\vec r} {\times} {\vec F}) \\
                         &amp;= {\vec r} ({\vec r} {\cdot} {\vec F}) - {\vec F}({\vec r} {\cdot}{\vec r})\end{split}\]</div>
</div>
<p>then the force can be calculated after the rearrangments the  as the following</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[{\vec F} = {\frac {{\vec r}({\vec r} {\cdot} {\vec F}) - {\vec r} {\times} {\vec \Gamma}}{|r^2|}}\]</div>
</div>
<p>Here, we assume that the force is perpendicular to the particle, <span class="math notranslate nohighlight">\({\vec r} {\cdot} {\vec F} = 0\)</span>, hence</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[{\vec F} = {\frac {- {\vec r} {\times} {\vec \Gamma}}{|r^2|}}\]</div>
</div>
<p>which means the smaller the length of the particle the stronger the force and the longer the particle the weaker the force.</p>
<div class="admonition error">
<p class="admonition-title">Error</p>
<p>This math doesn’t explain the length at all. Where is the length in this? Rewrite.</p>
</div>
<p>As the effective length of the nematogens, it couples the torque on MPCD particle into force on boundaries. The smaller the length of the particle the stronger the force and the longer the particle the weaker the force. To set it, add the following to your input <code class="docutils literal notranslate"><span class="pre">.json</span></code> file:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>&quot;len&quot;:    &lt;value&gt;,
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The default value, 0.007, is set.</p>
</div>
</section>
</section>
<section id="active-fluid">
<span id="activityparticles"></span><h3>Active fluid<a class="headerlink" href="#active-fluid" title="Permalink to this heading">#</a></h3>
<p>To make MPCD active, intrinsically out-of-equilibrium terms must be included in the collision operation. This can be done for both nematic and polar fluids by selecting the proper <a class="reference internal" href="#chaptercollop"><span class="std std-ref">collision operators</span></a>.</p>
<section id="active-nematic">
<span id="activenematicparticles"></span><h4>Active nematic<a class="headerlink" href="#active-nematic" title="Permalink to this heading">#</a></h4>
<p>For an active nematic, <code class="docutils literal notranslate"><span class="pre">&quot;act&quot;</span></code> sets the type and the magnitude of the force dipole for each fluid-species. Positive values corresponds to extensile activity and negative values to contractile. Each <a class="reference internal" href="#anmpcd"><span class="std std-ref">collision operator</span></a> has a defined region for this activity parameter in which <strong>active</strong> turbulence exists.</p>
<p>To set it, add the following to your input <code class="docutils literal notranslate"><span class="pre">.json</span></code> file:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>&quot;act&quot;:    &lt;value&gt;,
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The default value is 0.05.</p></li>
<li><p>The turbulence regime for extensile and contractile are not the same.</p></li>
</ul>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The active turbulence regime has been found within the regime <span class="math notranslate nohighlight">\(0.03\leq\zeta\leq0.08\)</span>.
For smaller values, the injected energy is absorbed by the thermostat, while the density varies substantially for larger values.</p>
</div>
</section>
<section id="active-polar">
<span id="activepolarparticles"></span><h4>Active polar<a class="headerlink" href="#active-polar" title="Permalink to this heading">#</a></h4>
<div class="admonition error">
<p class="admonition-title">Error</p>
<p>Must be written yet. Cite <a class="reference internal" href="../References/References.html#baziei2025" id="id9"><span>[Baziei2025]</span></a> .</p>
</div>
</section>
</section>
<section id="multiphase">
<span id="multiphaseparticles"></span><h3>Multiphase<a class="headerlink" href="#multiphase" title="Permalink to this heading">#</a></h3>
<p>MPCD particles can belong to different fluid-species to induce multi-phases.</p>
<p>Set whether or not the fluid is multiphase using the <code class="docutils literal notranslate"><span class="pre">&quot;multiphase&quot;</span></code> tag <strong>outside</strong> of the <code class="docutils literal notranslate"><span class="pre">&quot;species&quot;</span></code> array:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>&quot;multiphase&quot;: &lt;value&gt;,
</pre></div>
</div>
<ul class="simple">
<li><p>Single phase</p></li>
</ul>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;multiphase&quot;</span><span class="p">:</span><span class="w">         </span><span class="mi">0</span><span class="p">,</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Multiphase interactions via a surface fitter-version</p></li>
</ul>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;multiphase&quot;</span><span class="p">:</span><span class="w">         </span><span class="mi">1</span><span class="p">,</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Multiphase interactions via a point gradient-version.</p></li>
</ul>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;multiphase&quot;</span><span class="p">:</span><span class="w">         </span><span class="mi">2</span><span class="p">,</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The default value is 0.</p>
</div>
<p>All other multiphase particle parameters are fluid-species specific and are set in the <code class="docutils literal notranslate"><span class="pre">&quot;species&quot;</span></code> array. To introduce different fluid-species with different properties to the system, <code class="docutils literal notranslate"><span class="pre">&quot;species&quot;</span></code> array in the <code class="docutils literal notranslate"><span class="pre">.json</span></code> file gets several elements. The number of elements is equal to the number of fluid-species. For instance if there are two fluid-species with different activities, the following changes should be applied</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>&quot;species&quot;:
[
  {
    &quot;comment&quot;: &quot;MPCD species 1&quot;,
    ...,
    ...,
    &quot;act&quot;:          0.08
  },
  {
    &quot;comment&quot;: &quot;MPCD species 2&quot;,
    ...,
    ...,
    &quot;act&quot;:          0.03
  }
],
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Other properties mentioned earlier in this section should be initialized for each fluid-species based on the required properties, otherwise the default values are assumed.</p></li>
</ul>
</div>
<section id="interaction-matrix">
<h4>Interaction matrix<a class="headerlink" href="#interaction-matrix" title="Permalink to this heading">#</a></h4>
<p>Each fluid-species has a different interaction with all other fluid-species in a multiphase fluids and this matrix specifies how they interact, as described in the <span class="xref std std-ref">collision operator</span> section. To set it, add the following to your input <code class="docutils literal notranslate"><span class="pre">.json</span></code> file:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>&quot;interMatr&quot;:    [&lt;value1&gt;,&lt;value2&gt;,...],
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It <strong>must</strong> be of the same length as the number of fluid-species. Default will autopopulate with zeros, <code class="docutils literal notranslate"><span class="pre">[0,...]</span></code>.</p>
</div>
</section>
</section>
</section>
<section id="mpcd-cell-properties">
<span id="chaptercell"></span><h2>MPCD cell properties<a class="headerlink" href="#mpcd-cell-properties" title="Permalink to this heading">#</a></h2>
<p>Though particle properties are continuous, collision events occur on a descretized lattice of cells.
Each cell <span class="math notranslate nohighlight">\(c\)</span> has a number of properties, which are interpretted as the discretized values of the macroscopic fields.</p>
<section id="cell-size">
<span id="cellsize"></span><h3>Cell size<a class="headerlink" href="#cell-size" title="Permalink to this heading">#</a></h3>
<p>The MPCD collisions occur on a square/cubic lattice with lattice constant <span class="math notranslate nohighlight">\(a=1\)</span>. The lattice size sets the <a class="reference internal" href="../Algorithm/Background.html#set-values"><span class="std std-ref">units of length for the simulation</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>While users are strongly encouraged to keep the fundamental units of mass <span class="math notranslate nohighlight">\(m=1\)</span> and energy <span class="math notranslate nohighlight">\(k_\text{B}T=1\)</span>, users do have the ability to change this. The lattice constant cannot be changed. This is so that integer operations can be used to bin particles into MPCD cells for collision events.</p>
</div>
</section>
<section id="numberincell">
<span id="id10"></span><h3>Number density<a class="headerlink" href="#numberincell" title="Permalink to this heading">#</a></h3>
<p>Each cell <span class="math notranslate nohighlight">\(c\)</span> has an instantaneous number of MPCD particles <span class="math notranslate nohighlight">\(N_c(t)\)</span>.
Since the cells have a lattice size <span class="math notranslate nohighlight">\(a=1\)</span>, the instantaneous number is equivalent to the number density <span class="math notranslate nohighlight">\(n_c(t)=N_c(t)/a^d\)</span>, where <span class="math notranslate nohighlight">\(d\)</span> is the dimensionality.</p>
<p>If the mass of all the fluid-particles is set to <a class="reference internal" href="../Algorithm/Background.html#set-values"><span class="std std-ref">unit mass</span></a> <span class="math notranslate nohighlight">\(m=1\)</span>, then then the instantaneous number is also equivalent to the mass <span class="math notranslate nohighlight">\(M_c(t) = m N_c(t)\)</span> and the mass density <span class="math notranslate nohighlight">\(\rho_c(t) = M_c(t)/a^d\)</span>. However, if non-MPCD fluid particles are included in the collision event (such as monomers from <a class="reference internal" href="ExtraTheory.html#chapter11"><span class="std std-ref">molecular dynamics</span></a> or <a class="reference internal" href="ExtraTheory.html#id26"><span class="std std-ref">TADPole swimmers</span></a>), then the mass of those particles is also be included.</p>
</section>
<section id="center-of-mass-velocity">
<h3>Center of mass velocity<a class="headerlink" href="#center-of-mass-velocity" title="Permalink to this heading">#</a></h3>
<p>The center of mass velocity of the <span class="math notranslate nohighlight">\(N_c(t)\)</span> particles that are instantaneously in cell :math`c` is</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\vec{v}_c(t) = \left\langle \vec{v}_i \right\rangle = \frac{\sum_i^{N_c} m_i \vec{v}_i(t)}{\sum_i^{N_c} m_i} .\]</div>
</div>
<p>In MPCD, the centre of mass velocity of the cells is interpretted as the hydrodynamic-scale velocity field <span class="math notranslate nohighlight">\(\vec{v}(\vec{r},t)\)</span>.</p>
</section>
<section id="center-of-mass">
<span id="cmofcell"></span><h3>Center of mass<a class="headerlink" href="#center-of-mass" title="Permalink to this heading">#</a></h3>
<p>The center of mass position of the <span class="math notranslate nohighlight">\(N_c(t)\)</span> particles that are instantaneously in cell :math`c` is</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\vec{r}_c(t) = \left\langle \vec{r}_i \right\rangle = \frac{\sum_i^{N_c} m_i \vec{r}_i(t)}{\sum_i^{N_c} m_i} .\]</div>
</div>
</section>
<section id="moment-of-inertia">
<h3>Moment of inertia<a class="headerlink" href="#moment-of-inertia" title="Permalink to this heading">#</a></h3>
<p>The moment of inertia of the <span class="math notranslate nohighlight">\(N_c(t)\)</span> particles that are instantaneously in cell :math`c` is</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[I_c(t) = \sum_i^{N_c} m_i (\vec{r}_i-\vec{r}_c) \otimes (\vec{r}_i-\vec{r}_c) .\]</div>
</div>
</section>
<section id="nematic-order">
<h3>Nematic order<a class="headerlink" href="#nematic-order" title="Permalink to this heading">#</a></h3>
<p>Nematic fluids are composed of particles with an orientation <span class="math notranslate nohighlight">\({\vec u}_i\)</span> and cells have local orientational order measured by the tensor order parameter</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[Q_c = {\frac {1}{d-1}} &lt; d {\vec u}_i \otimes {\vec u}_i - {\hat 1}&gt;_{N_c}\]</div>
</div>
<p>of the cell <span class="math notranslate nohighlight">\(c\)</span>. For a nematic fluid, the largest eigenvalue of this tensor order is the local scalar order parameter, <span class="math notranslate nohighlight">\(S_c\)</span>, of the cell and the local director, <span class="math notranslate nohighlight">\(n_c\)</span>, is parallel to the corresponding eigenvector.</p>
</section>
<section id="local-velocity-gradient-tensor">
<span id="velgrad"></span><h3>Local velocity gradient tensor<a class="headerlink" href="#local-velocity-gradient-tensor" title="Permalink to this heading">#</a></h3>
<p>The local velocity gradient <span class="math notranslate nohighlight">\(\vec{\nabla}\vec{v}_c\)</span> is needed for nematic-MPCD to allow the local director to respond to the flow field. The D3Q15 and D2Q9 gradients are used for three and two dimensions, respectively.</p>
</section>
<section id="galilean-invariance">
<span id="galilean"></span><h3>Galilean invariance<a class="headerlink" href="#galilean-invariance" title="Permalink to this heading">#</a></h3>
<p>By discretizing the space into cells, <strong>Galilean invariance</strong> is broken <a class="reference internal" href="../References/References.html#ihle2003" id="id11"><span>[Ihle2003]</span></a>.
To understand why, consider a simulation of slow moving fluid particles (low temperatures).
If the mean-free path of the molecules (see <a class="reference internal" href="ExtraTheory.html#chaptervisc"><span class="std std-ref">Viscosity</span></a>) is much smaller than the cell size (<span class="math notranslate nohighlight">\(\lambda \ll a\)</span>) then particles will often fail to travel far enough to leave the cell and may repeatedly exchange momentum with the same set of neighbours.
Thus, the implicit assumption of underlying molecular chaos fails and the fixed lattice of cells causes the behaviour in a moving reference frame to be different than a fixed reference frame, since in the moving frame the set of neighbours would be different in each (fig{fig:galInv}).
However, Galilean invariance can be completely reestablished by shifting the cell grid each time step by a random vector.
Galilean invariance is then remedied.
Practically speaking, this is implemented by shifting all the fluid particles by the same vector whose components were chosen at random from the interval <span class="math notranslate nohighlight">\(\left[-a/2,a/2\right]\)</span>.</p>
<figure class="align-center" id="id30">
<a class="reference internal image-reference" href="../_images/galileanInv.png"><img alt="Logo" src="../_images/galileanInv.png" style="width: 365.7px; height: 376.5px;" /></a>
<figcaption>
<p><span class="caption-text">Galilean invariance is restored by randomly shifting the lattice of MPCD cells.</span><a class="headerlink" href="#id30" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Set whether or not to apply the Galilean invariance shift using the <code class="docutils literal notranslate"><span class="pre">&quot;galInv&quot;</span></code> tag <strong>outside</strong> of the <code class="docutils literal notranslate"><span class="pre">&quot;species&quot;</span></code> array:</p>
<ul class="simple">
<li><p>On</p></li>
</ul>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;galInv&quot;</span><span class="p">:</span><span class="w">         </span><span class="mi">1</span><span class="p">,</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Off</p></li>
</ul>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;galInv&quot;</span><span class="p">:</span><span class="w">         </span><span class="mi">0</span><span class="p">,</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The default value is 1.</p>
</div>
<dl class="simple">
<dt><span class="xref std std-ref">galInv</span></dt><dd><ul class="simple">
<li><p>int</p></li>
<li><p>1</p></li>
<li><p>Whether to enable the random shift of particles to counter Gallilean variance of grid-based algorithm</p></li>
</ul>
</dd>
</dl>
</section>
<section id="thermostats">
<span id="thermostat"></span><h3>Thermostats<a class="headerlink" href="#thermostats" title="Permalink to this heading">#</a></h3>
<p>In driving flows, work is done. Because the MPCD fluid is viscous, the work done on the fluid is continually converted into heat by internal friction, as represented by the MPCD collision operator.</p>
<p>In real systems, such heating occurs but is often mediated and removed by container walls acting as reservoirs. Thermostats are algorithms that act as virtual reservoirs for the simulation. They keep the system near the desired fixed temperature even when work is being done on the fluid. Thermal-wall boundary conditions are discussed in <a class="reference internal" href="#thermalbcs"><span class="std std-ref">thermal boundary conditions</span></a>. Some MPCD collision operators conserve energy (such as <a class="reference internal" href="#srd"><span class="std std-ref">SRD</span></a>), while others conserve thermal energy (such as <a class="reference internal" href="#andersen"><span class="std std-ref">Andersen-thermostatted MPCD</span></a>).</p>
<p>The MPCD fluid will have an instantaneous thermal energy, calculated via the equipartition function to be <span class="math notranslate nohighlight">\(k_\text{B}T(t) = \sum_i \left(\vec{v}_i-\left\langle\vec{v}\right\rangle\right)^2 / (d N_\text{tot})\)</span>, where <span class="math notranslate nohighlight">\(\left\langle\vec{v}\right\rangle\)</span> is the system averaged velocity, <span class="math notranslate nohighlight">\(d\)</span> is the dimensionality and <span class="math notranslate nohighlight">\(N_\text{tot}\)</span> is the total number of MPCD particles. The thermostat has a set thermal energy <span class="math notranslate nohighlight">\(k_\text{B}T_0\)</span>.</p>
<p>For operations that conserve energy, a user may wish to apply a global or local thermostat. <code class="docutils literal notranslate"><span class="pre">&quot;tsTech&quot;</span></code> specifies which thermostat is applied:</p>
<ul>
<li><p>None</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;tsTech&quot;</span><span class="p">:</span><span class="w">         </span><span class="mi">0</span><span class="p">,</span>
</pre></div>
</div>
</li>
<li><p>Velocity scaling is used as the thermostat.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;tsTech&quot;</span><span class="p">:</span><span class="w">         </span><span class="mi">1</span><span class="p">,</span>
</pre></div>
</div>
<p>The simplest method to thermostat a system is to rescale the velocities. Since the intantaneous kinetic energy of the constituents constitutes the thermal energy, a desired temperature is achieved by scaling every velocity by <span class="math notranslate nohighlight">\(\sqrt{T_0/T}\)</span>. Rescaling the velocity in this way instantaneously moves the temperature to its fixed value of <span class="math notranslate nohighlight">\(T_0\)</span>.</p>
</li>
<li><p>The Berendsen thermostat is used.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;tsTech&quot;</span><span class="p">:</span><span class="w">         </span><span class="mi">2</span><span class="p">,</span>
</pre></div>
</div>
<p>The Berendsen thermostat rescales the velocities but does so with a temporal relaxation toward the thermostat value over a finite period of time. The Berendsen thermostat defines a relaxation time, <span class="math notranslate nohighlight">\(\tau_\text{R}\)</span>, that moves <span class="math notranslate nohighlight">\(T/T_0 \to 1\)</span> by rescaling the velocities by <span class="math notranslate nohighlight">\(\left[ 1+\left(T/T_0-1\right)\left(\delta t / \tau_\text{R}\right) \right]^{1/2}\)</span>.</p>
<p>The relaxation time is set by:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>&quot;tau&quot;:         &lt;value&gt;,
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The default value is 0.5.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Both the velocity rescaling and the Berendsen thermostats share some weaknesses:</p>
<ul class="simple">
<li><p>If the temperature increases in one region of the fluid then both of these global, velocity e-scaling thermostats will cool distant regions.</p></li>
<li><p>Even if work is being done to drive macroscopic flow in a particular direction, these thermostats will scale velocity in all directions, repressing thermal motion in the perpendicular directions in an attempt to lower the total kinetic energy. In extreme cases, fluctuations are repressed.</p></li>
</ul>
</div>
</li>
<li><p>The Heyes thermostat is used.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;tsTech&quot;</span><span class="p">:</span><span class="w">         </span><span class="mi">3</span><span class="p">,</span>
</pre></div>
</div>
<p>The Heyes algorithm is a stochastic thermostat that is applied <strong>locally</strong> to each MPCD cell. In a sense (like acceleration or velocity rescaling) it becomes a part of the collision operation. The Heyes thermostat enacts the following procedure:</p>
<ul class="simple">
<li><p>A random number is homogeneously generated in the range <span class="math notranslate nohighlight">\(r_1 \in \left[1,1+c\right]\)</span>, where <span class="math notranslate nohighlight">\(c\)</span> is the control parameter of the thermostat and should be between 0.05 and 0.3.</p></li>
<li><p>Generate a second random number <span class="math notranslate nohighlight">\(r_2 \in \left[0,1\right]\)</span>.</p>
<ul>
<li><p>If the second random number is <span class="math notranslate nohighlight">\(r_2 &gt; 0.5\)</span> then the scaling factor is the first random number, <span class="math notranslate nohighlight">\(\gamma = r_1\)</span>.</p></li>
<li><p>Else the scaling factor is the inverse of the first random number, :math:<a href="#id12"><span class="problematic" id="id13">`</span></a>gamma=r_1^{-1}$</p></li>
</ul>
</li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>Generate a third (and final) random number <span class="math notranslate nohighlight">\(r_3 \in \left[0,1\right]\)</span> and let</p></li>
</ul>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[A = \gamma^{\dim\left(N_c-1\right)} \exp{\left[-\left(\frac{\gamma^2-1}{2 k_\text{B} T_0}\right) \sum_i^{N_c} m_i \left( \vec{v}_i-\vec{v}c \right)^2 \right]}.\]</div>
</div>
<p>If <span class="math notranslate nohighlight">\(r_3 \geq \text{min}\left[1,A\right]\)</span> then set $gamma=1$ (i.e. do not rescale the velocities in the current cell).</p>
<ul class="simple">
<li><p>Rescale the velocities in the current cell.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>The final option is not a thermostat. It sets the maximum velocity (by hijacking the <code class="docutils literal notranslate"><span class="pre">grav</span></code>).</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>&quot;tsTech&quot;:         4,
&quot;grav&quot;:           [&lt;value&gt;,&lt;value&gt;,&lt;value&gt;],
</pre></div>
</div>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The default value is 0.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If a thermostat is needed, users are encouraged to use <a class="reference internal" href="#andersen"><span class="std std-ref">Andersen-thermostatted MPCD</span></a> (<span class="xref std std-ref">Langevin-thermostatted MPCD</span> is also an option).</p>
</div>
</section>
</section>
<section id="collision-operators">
<span id="chaptercollop"></span><h2>Collision operators<a class="headerlink" href="#collision-operators" title="Permalink to this heading">#</a></h2>
<p>The cell-based collision operator lies at the heart of the <a class="reference internal" href="../Algorithm/Background.html#collision"><span class="std std-ref">MPCD method</span></a>.</p>
<p>NIAMH-MPCD supports over twenty collision operators <span class="math notranslate nohighlight">\(\vec\Xi\)</span>.
These are set in the input <code class="docutils literal notranslate"><span class="pre">.json</span></code> file using either the <code class="docutils literal notranslate"><span class="pre">&quot;rTech&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;collOp&quot;</span></code> keywords as follows:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&quot;collOp&quot;: &lt;int value&gt;</span>
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">&lt;int</span> <span class="pre">value&gt;</span></code> is an integer code corresponding to the desired collision operator.</p>
<p>In this section, we describe the various families of collision operators available in MPCD, state their associated keycodes, and describe the parameters they use.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Some aspects of the collision operation are set outside of the <code class="docutils literal notranslate"><span class="pre">&quot;species&quot;</span></code> array in the <code class="docutils literal notranslate"><span class="pre">.json</span></code> input file, while other aspects are species specific. The <a class="reference internal" href="#usagechapter"><span class="std std-ref">usage</span></a>, <a class="reference internal" href="../Input/inputFiles.html#inputtable"><span class="std std-ref">input tables</span></a> and <a class="reference internal" href="../Tutorials/Tutorials.html#tutorials"><span class="std std-ref">tutorials</span></a> make clear where to specify each parameter.</p>
</div>
<section id="stochastic-rotation-dynamics">
<span id="srd"></span><h3>Stochastic rotation dynamics<a class="headerlink" href="#stochastic-rotation-dynamics" title="Permalink to this heading">#</a></h3>
<p>The original implementation of MPCD is known as Stochastic Rotation Dynamics (SRD) <a class="reference internal" href="../References/References.html#gompper2009" id="id14"><span>[Gompper2009]</span></a>.
Translating to modern terminology, SRD’s collision operator <span class="math notranslate nohighlight">\(\vec\Xi\)</span> choses a random axis, around which it performs
a rotation through an angle <span class="math notranslate nohighlight">\(\theta\)</span>. This is done by conservating energy, preserving isotropy and the Maxwell Boltzmann velocity distribution in the continuum limit.
This random rotation is what gives its this MPCD variant its name: Stochastic Rotation Dynamics (SRD).</p>
<p>More formally, the SRD the collision operator is</p>
<div class="math-wrapper docutils container" id="eq-srd">
<span id="equation-eq-srd"></span><div class="math notranslate nohighlight" id="eq-srd">
<span id="equation-eq-srd"></span><span class="eqno">(1)<a class="headerlink" href="#eq-srd" title="Permalink to this equation">#</a></span>\[\vec{\Xi}_i^\mathrm{SRD}(t) = \Omega_\theta \cdot \left(
    \vec{v}_i(t) - \vec{v}_{cm}(t)
\right)\]</div>
</div>
<p>in which <span class="math notranslate nohighlight">\(\Omega_\theta\)</span> is a rotation tensor through an angle <span class="math notranslate nohighlight">\(\theta\)</span> about a given axis, and <span class="math notranslate nohighlight">\(\vec{v}_{cm}\)</span> is the center of mass velocity of the particles in the collision cell.</p>
<p>Being a 3D rotation tensor, <span class="math notranslate nohighlight">\(\Omega_\theta\)</span> is defined as</p>
<div class="math-wrapper docutils container" id="eq-srd-rotation-tensor">
<span id="equation-eq-srd-rotation-tensor"></span><div class="math notranslate nohighlight" id="eq-srd-rotation-tensor">
<span id="equation-eq-srd-rotation-tensor"></span><span class="eqno">(2)<a class="headerlink" href="#eq-srd-rotation-tensor" title="Permalink to this equation">#</a></span>\[\begin{split}\begin{align}
    \Omega_\theta &amp;= \begin{pmatrix}
        n_x^2+(1-n_x^2)\cos\theta &amp; n_xn_y\left(1 - \cos\theta\right)-n_z \sin\theta &amp; n_xn_z\left(1-\cos\theta\right)+n_y \sin\theta \\
        n_xn_y \left(1 - \cos\theta\right)+n_z \sin\theta &amp; n_y^2 + \left(1-n_y^2\right)\cos\theta &amp; n_yn_z \left(1 - \cos\theta\right)-n_x \sin\theta \\
        n_xn_z\left(1 - \cos\theta\right)-n_y \sin\theta &amp; n_yn_z\left(1 - \cos\theta\right)+n_x \sin\theta  &amp;n_z^2 + \left(1-n_z^2\right)\cos\theta
    \end{pmatrix},
\end{align}\end{split}\]</div>
</div>
<p>in which the vector <span class="math notranslate nohighlight">\(\hat{n} = [n_x, n_y, n_z]\)</span> defines a unit vector representing the axis of rotation.</p>
<p>A visual description of the algorithmic implementation of the SRD collision operator is shown below.</p>
<div class="table-wrapper colwidths-given docutils container">
<table class="docutils align-center">
<colgroup>
<col style="width: 33.3%" />
<col style="width: 33.3%" />
<col style="width: 33.3%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><a class="reference internal image-reference" href="../_images/SRD1.png"><img alt="../_images/SRD1.png" class="align-center" src="../_images/SRD1.png" style="width: 95%;" /></a>
</td>
<td><a class="reference internal image-reference" href="../_images/SRD2.png"><img alt="../_images/SRD2.png" class="align-center" src="../_images/SRD2.png" style="width: 95%;" /></a>
</td>
<td><a class="reference internal image-reference" href="../_images/SRD3.png"><img alt="../_images/SRD3.png" class="align-center" src="../_images/SRD3.png" style="width: 95%;" /></a>
</td>
</tr>
<tr class="row-even"><td><p><strong>(a)</strong> Bin MPCD particles into cells.</p></td>
<td><p><strong>(b)</strong> Calculate the center of mass velocity <span class="math notranslate nohighlight">\(\vec{v}^\mathrm{cm}\)</span> of the cell.</p></td>
<td><p><strong>(c)</strong> For each MPCD particle, calculate the difference from <span class="math notranslate nohighlight">\(\vec{v}^\mathrm{cm}\)</span>.</p></td>
</tr>
<tr class="row-odd"><td><a class="reference internal image-reference" href="../_images/SRD4.png"><img alt="../_images/SRD4.png" class="align-center" src="../_images/SRD4.png" style="width: 95%;" /></a>
</td>
<td><a class="reference internal image-reference" href="../_images/SRD5.png"><img alt="../_images/SRD5.png" class="align-center" src="../_images/SRD5.png" style="width: 95%;" /></a>
</td>
<td></td>
</tr>
<tr class="row-even"><td><p><strong>(d)</strong> For each MPCD particle, generate a random unit vector <span class="math notranslate nohighlight">\(\hat{n}^\mathrm{ran}\)</span>.</p></td>
<td><p><strong>(e)</strong> Rotate each difference about <span class="math notranslate nohighlight">\(\hat{n}^\mathrm{ran}\)</span> by <span class="math notranslate nohighlight">\(\theta\)</span>.</p></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<p>The version of SRD in where <span class="math notranslate nohighlight">\(\hat{n}\)</span> is chosen from the unit sphere is implemented with a keycode of <code class="docutils literal notranslate"><span class="pre">0</span></code>.
To use it add the following to your input <code class="docutils literal notranslate"><span class="pre">.json</span></code> file:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&quot;collOp&quot;: 0</span>
</pre></div>
</div>
<p>However, in order to reproduce in bulk a fluid with the correct hydrodynamic properties, it is sufficient to choose the axis of rotation <span class="math notranslate nohighlight">\(\vec{\hat{n}}\)</span> randomly from the cartesian axes, i.e., <span class="math notranslate nohighlight">\(\vec{\hat{n}} = [1, 0, 0]\)</span>, <span class="math notranslate nohighlight">\([0, 1, 0]\)</span> or <span class="math notranslate nohighlight">\([0, 0, 1]\)</span>, which increases the efficiency of the algorithm.</p>
<p>This version of SRD is implemented with a keycode of <code class="docutils literal notranslate"><span class="pre">1</span></code>.
To use it add the following to your input <code class="docutils literal notranslate"><span class="pre">.json</span></code> file:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&quot;collOp&quot;: 1</span>
</pre></div>
</div>
<p>It is possible to verify that momentum and energy are conserved before and after collision by explicitly computing them.</p>
</section>
<section id="andersen-thermostatted-mpcd">
<span id="andersen"></span><h3>Andersen-thermostatted MPCD<a class="headerlink" href="#andersen-thermostatted-mpcd" title="Permalink to this heading">#</a></h3>
<p>While SRD is sufficient for some applications, it is not without its drawbacks:</p>
<ul class="simple">
<li><p>The SRD collision operator does not generally conserve angular momentum, as it does not consider the positions of particles within the cell.</p></li>
<li><p>An explicit external thermostat is required to control the system energy when external forces or activity are applied.</p></li>
</ul>
<p>Following other mesoscale simulation techniques, such as DPD, where a thermostat is included intrinsically as part of the simulation technique, thermostats have been incoroporated into MPCD collision operators.
That is, <span class="math notranslate nohighlight">\(\vec\Xi\)</span> acts both as the collision operator and a local thermostat for the cell, such that no velocity rescaling techniques are necessary.</p>
<p>The primary thermostatted collision operator in this simulator is the Andersen thermostatted collision operator <a class="reference internal" href="../References/References.html#gompper2009" id="id15"><span>[Gompper2009]</span></a>, defined as</p>
<div class="math-wrapper docutils container" id="eq-andersenop">
<span id="equation-eq-andersenop"></span><div class="math notranslate nohighlight" id="eq-andersenop">
<span id="equation-eq-andersenop"></span><span class="eqno">(3)<a class="headerlink" href="#eq-andersenop" title="Permalink to this equation">#</a></span>\[\vec{\Xi}_i^\mathrm{A}(t) =
\vec\xi_i -
\frac{\sum_j^{N_C} m_j \vec\xi_j}{\sum_j^{N_C} m_j},\]</div>
</div>
<p>in which each component of <span class="math notranslate nohighlight">\(\vec\xi_i\)</span> is randomly generated from a Gaussian distribution with variance <span class="math notranslate nohighlight">\(\sqrt{k_B T/ m}\)</span>.</p>
<p>The final term in <a class="reference internal" href="#eq-andersenop"><span class="std std-ref">the Andersen collision operator</span></a> is referred to as the residual, and denoted <span class="math notranslate nohighlight">\(\langle \vec\xi_j \rangle_{N_C}\)</span>.
Each fluid particle in a given cell is assigned a new, randomly chosen velocity during each collision.
However, the presence of the residual means that each particle’s velocity is a new randomly assigned value, minus the mass weighted velocity of all the new random values for that cell. This ensures that the center of mass velocity of each cell does not change during collision, ensuring moomentum conservation.</p>
<div class="table-wrapper colwidths-given docutils container">
<table class="docutils align-center">
<colgroup>
<col style="width: 50.0%" />
<col style="width: 50.0%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><a class="reference internal image-reference" href="../_images/Andersen1.png"><img alt="../_images/Andersen1.png" class="align-center" src="../_images/Andersen1.png" style="width: 95%;" /></a>
</td>
<td><a class="reference internal image-reference" href="../_images/Andersen2.png"><img alt="../_images/Andersen2.png" class="align-center" src="../_images/Andersen2.png" style="width: 95%;" /></a>
</td>
</tr>
<tr class="row-even"><td><p><strong>(a)</strong> Bin MPCD particles into cells.</p></td>
<td><p><strong>(b)</strong> Calculate the center of mass velocity <span class="math notranslate nohighlight">\(\vec{v}^\mathrm{cm}\)</span> of the cell.</p></td>
</tr>
<tr class="row-odd"><td><a class="reference internal image-reference" href="../_images/Andersen3.png"><img alt="../_images/Andersen3.png" class="align-center" src="../_images/Andersen3.png" style="width: 95%;" /></a>
</td>
<td><a class="reference internal image-reference" href="../_images/Andersen4.png"><img alt="../_images/Andersen4.png" class="align-center" src="../_images/Andersen4.png" style="width: 95%;" /></a>
</td>
</tr>
<tr class="row-even"><td><p><strong>(c)</strong> For each MPCD particle, generate a random velocity that sums to <span class="math notranslate nohighlight">\(\vec{v}^\mathrm{cm}\)</span>.</p></td>
<td><p><strong>(d)</strong> Apply to each MPCD particle.</p></td>
</tr>
</tbody>
</table>
</div>
<p>The Andersen thermostatted collision operator is implemented with a keycode of <code class="docutils literal notranslate"><span class="pre">2</span></code>.
To use it, add the following to your input <code class="docutils literal notranslate"><span class="pre">.json</span></code> file:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&quot;collOp&quot;: 2</span>
</pre></div>
</div>
<p>Note that the <a class="reference internal" href="#eq-andersenop"><span class="std std-ref">the basic Andersen collision operator</span></a> conserves mass and translational momentum, but not angular momentum (or energy, as it is thermostatted).
However, it can be extended to do so. The basic Andersen collision operator introduces a small change in angular momentum every timestep, which we denote <span class="math notranslate nohighlight">\(\delta \vec{L}\)</span>.
This can be cancelled out by applying a small counter-rotation to each particle, such that the total angular momentum change is zero.
If the particles in the cell have a given intertia tensor <span class="math notranslate nohighlight">\(I\)</span> about the center of mass, then the required counter-rotation required is <span class="math notranslate nohighlight">\(\vec \omega = I^{-1} \cdot \delta \vec{L}\)</span>.</p>
<p>This correction is done by adding an extra term to the Andersen collision operator that performs this counter-rotation</p>
<div class="math-wrapper docutils container" id="eq-andersenopangular">
<span id="equation-eq-andersenopangular"></span><div class="math notranslate nohighlight" id="eq-andersenopangular">
<span id="equation-eq-andersenopangular"></span><span class="eqno">(4)<a class="headerlink" href="#eq-andersenopangular" title="Permalink to this equation">#</a></span>\[\vec{\Xi}_i^\mathrm{A}(t) =
\vec\xi_i -
\langle \vec\xi_j \rangle_{N_C} +
\left[
    I^{-1} \cdot \left(
        \sum_j^{N_C} m_j \left\lbrace
            \vec{x}'_j \times (\vec{v}_j - \vec\xi_j)
        \right\rbrace
    \right)
\right] \times \vec{x}'_j,\]</div>
</div>
<p>in which vec{x}’_j denotes the position of the particle with respect to the cell’s cooridnate center of mass.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The angular-conserving Andersen thermostatted collision operator above is the default, and preferred, collision operator in this MPCD simulator for traditional fluids.</p>
</div>
<p>The angular-conserving Andersen thermostatted collision operator is implemented with a keycode of <code class="docutils literal notranslate"><span class="pre">3</span></code>.
To use it, add the following to your input <code class="docutils literal notranslate"><span class="pre">.json</span></code> file:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&quot;collOp&quot;: 3</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The angular-conserving Andersen thermostatted collision operator is the basis used for the <a class="reference internal" href="ExtraTheory.html#chapter8"><span class="std std-ref">Nematic MPCD</span></a> algorithm.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>MPCD can also simulate active nematics using the <a class="reference internal" href="ExtraTheory.html#activenematic"><span class="std std-ref">Active Nematic MPCD</span></a> algorithm.</p>
</div>
<div class="admonition error">
<p class="admonition-title">Error</p>
<p>This is missing Langevin, passive nematic, active nematic, Vicsek</p>
</div>
</section>
<section id="conservation-of-angular-momentum">
<span id="angmom"></span><h3>Conservation of angular momentum<a class="headerlink" href="#conservation-of-angular-momentum" title="Permalink to this heading">#</a></h3>
<p>Multiple MPCD algorithm do not conserve angular momentum since they do not consider the positions of the fluid particles within the cell during a collision operation.
In many advecting situations angular momentum does not play an essential role and so this fact is inconsequential <a class="reference internal" href="../References/References.html#gotze2007" id="id16"><span>[Götze2007]</span></a> <a class="reference internal" href="../References/References.html#gotze2011" id="id17"><span>[Götze2011]</span></a> <a class="reference internal" href="../References/References.html#babu2012" id="id18"><span>[Babu2012]</span></a>.
To conserving the angular momentum of the cell, the change in angular momentum relative to the centre of mass position during the collision event position is calculated.
This angular momentum is then exactly cancelled out by giving the entire cell an appropriate angular velocity.
For situations in which angular momentum conservation within the solvent plays an important role, appropriate collision operators should be chosen (see <a class="reference internal" href="#chaptercollop"><span class="std std-ref">Collision operators</span></a>).</p>
</section>
<section id="nematic-mpcd">
<span id="nemcollop"></span><h3>Nematic MPCD<a class="headerlink" href="#nematic-mpcd" title="Permalink to this heading">#</a></h3>
<p>To set the mean field potential <span class="math notranslate nohighlight">\(U\)</span>, add the following to your <code class="docutils literal notranslate"><span class="pre">&quot;species&quot;</span></code> array in the input <code class="docutils literal notranslate"><span class="pre">.json</span></code> file:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>&quot;mfpot&quot;: &lt;value&gt;,
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The default value is 10.</p></li>
</ul>
</div>
</section>
<section id="active-nematic-mpcd">
<span id="anmpcd"></span><h3>Active-Nematic MPCD<a class="headerlink" href="#active-nematic-mpcd" title="Permalink to this heading">#</a></h3>
<p>To have a MPCD algorithm that conserves momentum (wet) in the active fluids, energy is injected to the fluid constituents in the collision operator, while momentum is conserved. To do so, active stress is introduced to fluid in the form of a force dipole density acting on MPCD nematogens. This force dipole can be extensile or contractile <a class="reference internal" href="../References/References.html#kozhukhov2022" id="id19"><span>[Kozhukhov2022]</span></a>. The force dipole density acting on nematogens in the direction of the local cell director <span class="math notranslate nohighlight">\({\vec n}_c\)</span>.</p>
<p><code class="docutils literal notranslate"><span class="pre">&quot;act&quot;&quot;</span></code> sets the type and the magnitude of the force dipole on each MPCD particle. Positive values corresponds to extensile force dipoles and negative values to contractile ones. Each collision operator has a defined region for this activity parameter in which <strong>active</strong> turbulence exists.</p>
<p>For an active nematic, <code class="docutils literal notranslate"><span class="pre">&quot;act&quot;&quot;</span></code> sets the type and the magnitude of the force dipole on each MPCD particle. Positive values corresponds to extensile activity and negative values to contractile. Each <a class="reference internal" href="#anmpcd"><span class="std std-ref">collision operator</span></a> has a defined region for this activity parameter in which <strong>active</strong> turbulence exists.</p>
<p>To set it, add the following to your input <code class="docutils literal notranslate"><span class="pre">.json</span></code> file:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>&quot;act&quot;:    &lt;value&gt;,
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The default value is 0.05.</p></li>
<li><p>The turbulence regime for extensile and contractile are not the same.</p></li>
</ul>
</div>
<section id="local-activity-modulators">
<span id="modulators"></span><h4>Local activity modulators<a class="headerlink" href="#local-activity-modulators" title="Permalink to this heading">#</a></h4>
<p>There are two parameters <span class="math notranslate nohighlight">\({\sigma}_p\)</span> and <span class="math notranslate nohighlight">\({\sigma}_w\)</span> used to modulate the local activity as a function of density <a class="reference internal" href="../References/References.html#kozhukhov2023" id="id20"><span>[Kozhukhov2023]</span></a> .</p>
<p><span class="math notranslate nohighlight">\({\sigma}_w\)</span> represents how fast should the modulation fall-off as a function of density. <span class="math notranslate nohighlight">\({\sigma}_p\)</span> is a measure of when modulation should begin. Positive values correspond to extensile force dipoles and negative values to contractile ones. Each collision operator has a defined region for this activity parameter in which <strong>active</strong> turbulence exists. <span class="math notranslate nohighlight">\({\sigma}_w\)</span> represents how fast the modulation falls-off as a function of density , should be &gt; 0, ideally around 0.4.</p>
<p>To set it, add the following to your input <code class="docutils literal notranslate"><span class="pre">.json</span></code> file:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>&quot;sigWidth&quot;:    &lt;value&gt;,
</pre></div>
</div>
<p><span class="math notranslate nohighlight">\({\sigma}_p\)</span> is a measure of when modulation should begin, should be in a range 0 to 2, ideally around 0.5.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>&quot;sigPos&quot;:    &lt;value&gt;,
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The default values are 1.0 for both parameters.</p></li>
</ul>
</div>
</section>
<section id="ratio-of-active-particles">
<span id="actratio"></span><h4>Ratio of active particles<a class="headerlink" href="#ratio-of-active-particles" title="Permalink to this heading">#</a></h4>
<p>Activity could be applied to a proportion of particles in the cell, the <strong>Minimum</strong> of which is this parameter.</p>
<p>Activity could be applied to a proportion of particles in the cell, the <strong>Minimum</strong> of which is this parameter.  To set it, add the following to your input <code class="docutils literal notranslate"><span class="pre">.json</span></code> file:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>&quot;minActRatio&quot;:    &lt;value&gt;,
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The default value is 0.</p>
</div>
</section>
</section>
<section id="active-polar-mpcd">
<span id="apmpcd"></span><h3>Active-Polar MPCD<a class="headerlink" href="#active-polar-mpcd" title="Permalink to this heading">#</a></h3>
</section>
<section id="id21">
<span id="id22"></span><h3>Active-Polar MPCD<a class="headerlink" href="#id21" title="Permalink to this heading">#</a></h3>
</section>
<section id="gravitational-acceleration">
<span id="grav"></span><h3>Gravitational acceleration<a class="headerlink" href="#gravitational-acceleration" title="Permalink to this heading">#</a></h3>
<p>An external forcing can be applied to the entire fluid. This is done through a “gravitational” acceleration <span class="math notranslate nohighlight">\(\vec{g}\)</span>. To set it, add the following to your input <code class="docutils literal notranslate"><span class="pre">.json</span></code> file:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>&quot;grav&quot;: [&lt;value&gt;,&lt;value&gt;,&lt;value&gt;],
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The provided array must be 3D, even if the system is 2D.</p></li>
<li><p>A pressure gradient <span class="math notranslate nohighlight">\(\vec{nabla}P\)</span> is equivalent to gravitational acceleration times mass density <span class="math notranslate nohighlight">\(\rho\vec{g}\)</span>. This is a convenient way to set a pressure gradient.</p></li>
<li><p>The default value is [0,0,0].</p></li>
</ul>
</div>
</section>
<section id="magnetic-field">
<span id="magfield"></span><h3>Magnetic field<a class="headerlink" href="#magnetic-field" title="Permalink to this heading">#</a></h3>
<p>A constant external magnetic field <span class="math notranslate nohighlight">\(\vec{H}\)</span> can rotate the fluid-particle orientations <span class="math notranslate nohighlight">\(\vec{u}_i\)</span>. The magnitude of the torque applied to the nematogen is proportional to <span class="math notranslate nohighlight">\(\chi ({\vec u}_i {\cdot} {\vec H})\)</span> in which the <span class="math notranslate nohighlight">\(\chi\)</span> is the <a class="reference internal" href="#magsus"><span class="std std-ref">magnetic susceptibility</span></a>.</p>
<blockquote>
<div><p>To set it, add the following to your input <code class="docutils literal notranslate"><span class="pre">.json</span></code> file:</p>
</div></blockquote>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>&quot;mag&quot;: [&lt;value&gt;,&lt;value&gt;,&lt;value&gt;],
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The provided array must be 3D, even if the system is 2D.</p></li>
<li><p>The default value is [0,0,0].</p></li>
</ul>
</div>
</section>
<section id="friction-coefficient">
<span id="damping"></span><h3>Friction coefficient<a class="headerlink" href="#friction-coefficient" title="Permalink to this heading">#</a></h3>
<p>A friction coefficient can be included in any of the collision operators to dampen hydrodynamics. By acting as a local momenutm sink, this damping lets the system go from wet to dry. The damping coefficient can take values in <span class="math notranslate nohighlight">\([0,1]\)</span>. To set it, add the following to your input <code class="docutils literal notranslate"><span class="pre">.json</span></code> file:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>&quot;damp&quot;: &lt;value&gt;,
</pre></div>
</div>
</section>
</section>
<section id="boundary-conditions">
<span id="chapterbc"></span><h2>Boundary conditions<a class="headerlink" href="#boundary-conditions" title="Permalink to this heading">#</a></h2>
<div class="admonition error" id="subsection-boundarysurfaces">
<p class="admonition-title">Error</p>
<p>TNS: You must say that the domain needs to be defined and the BCs need to be defined on top of the domain — the BCs need not coincide with the domain.</p>
</div>
<p>All simulations require boundary conditions.
Creating surfaces to define the fluid control volume, establishes the fluid domain over which the hydrodynamic interactions take place.
For this algorithm, boundary conditions are applied directly to fluid particles that violate <a class="reference internal" href="#eq-bccondition"><span class="std std-ref">surface equations</span></a>.</p>
<p>The following steps are required:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#subsection-boundarysurfaces"><span class="std std-ref">Surface definitions</span></a></p></li>
<li><p><a class="reference internal" href="#subsection-boundaryrules"><span class="std std-ref">Boundary condition rules</span></a></p></li>
</ul>
<p>These two processes can model a wide variety of fluid settings, including open systems (through periodic boundary conditions), channels and confinement in complex environments.</p>
<section id="surfaces">
<h3>Surfaces<a class="headerlink" href="#surfaces" title="Permalink to this heading">#</a></h3>
<p>All boundaries are defined by an implicit surface equation <span class="math notranslate nohighlight">\(S(\vec{x})=0\)</span>,
where <span class="math notranslate nohighlight">\(\vec{x}= (x,y,z)\)</span> are points on the surface.
There are multiple forms of implemented surfaces, which can be combined (setting non-zero surface parameters) or removed (setting surface parameters to zero).</p>
<section id="standard-surfaces">
<h4>Standard surfaces<a class="headerlink" href="#standard-surfaces" title="Permalink to this heading">#</a></h4>
<p>Standard surfaces have the form,</p>
<div class="math-wrapper docutils container" id="eq-surface">
<span id="equation-eq-surface"></span><div class="math notranslate nohighlight" id="eq-surface">
<span id="equation-eq-surface"></span><span class="eqno">(5)<a class="headerlink" href="#eq-surface" title="Permalink to this equation">#</a></span>\[S^S(\vec{x})=[A_x\left(x-Q_x\right)]^{p_x} + [A_y\left(y-Q_y\right)]^{p_y} + [A_z\left(z-Q_z\right)]^{p_z} - R^{p_R} = 0\]</div>
</div>
<p>where the surface parameters represent the surface position’s <span class="math notranslate nohighlight">\(\vec{Q}=(Q_x,Q_y,Q_z)\)</span>,
surface coefficient’s <span class="math notranslate nohighlight">\(\vec{A}=(A_x,A_y,A_z)\)</span>, surface power’s <span class="math notranslate nohighlight">\((p_x,p_y,p_z,p_R)\)</span> and radius <span class="math notranslate nohighlight">\(R\)</span>.
Writing surfaces in this way is versatile and enables <a class="reference internal" href="#eq-surfaceplane1"><span class="std std-ref">planes</span></a>, <a class="reference internal" href="#eq-surfacesphere"><span class="std std-ref">spheres</span></a>, <a class="reference internal" href="#eq-surfaceellipsoid"><span class="std std-ref">ellipsoids</span></a>, <a class="reference internal" href="#eq-surfacecylinder"><span class="std std-ref">cylinders</span></a>, <a class="reference internal" href="#eq-surfacesquircle"><span class="std std-ref">squircles</span></a> and <a class="reference internal" href="#eq-surfacesuperellipsoid"><span class="std std-ref">superellipsoids</span></a> to be created</p>
<p>Boundary properties can be created inside the input, using</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;BC&quot;</span><span class="p">:</span>
<span class="p">[</span>
  <span class="p">{</span>
    <span class="s2">&quot;comment&quot;</span><span class="p">:</span>      <span class="s2">&quot;Boundary properties&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Q&quot;</span><span class="p">:</span>            <span class="p">[</span><span class="n">Qx</span><span class="p">,</span> <span class="n">Qy</span><span class="p">,</span> <span class="n">Qz</span><span class="p">],</span>
    <span class="s2">&quot;aInv&quot;</span><span class="p">:</span>         <span class="p">[</span><span class="n">Ax</span><span class="p">,</span> <span class="n">Ay</span><span class="p">,</span> <span class="n">Az</span><span class="p">],</span>
    <span class="s2">&quot;P&quot;</span><span class="p">:</span>            <span class="p">[</span><span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">,</span> <span class="n">pz</span><span class="p">,</span> <span class="n">pR</span><span class="p">],</span>
    <span class="s2">&quot;R&quot;</span><span class="p">:</span>            <span class="n">R</span>
  <span class="p">}</span>
<span class="p">],</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>2D surfaces can be defined using the same surface parameters as 3D.
These are slices of 3D surfaces in the <span class="math notranslate nohighlight">\(xy\)</span> plane, where <span class="math notranslate nohighlight">\(z=0\)</span>.</p>
</div>
<ol class="arabic simple">
<li><p><strong>Plane</strong></p></li>
</ol>
<blockquote>
<div><p>To construct a plane, set <span class="math notranslate nohighlight">\(p_x=p_y=p_z=p_R=1\)</span>,
<span class="math notranslate nohighlight">\(Q_x=Q_y=Q_z=0\)</span> and <span class="math notranslate nohighlight">\(R=d\)</span> to give the surface equation</p>
<div class="math-wrapper docutils container" id="eq-surfaceplane1">
<span id="equation-eq-surfaceplane1"></span><div class="math notranslate nohighlight" id="eq-surfaceplane1">
<span id="equation-eq-surfaceplane1"></span><span class="eqno">(6)<a class="headerlink" href="#eq-surfaceplane1" title="Permalink to this equation">#</a></span>\[S(\vec{x})= A_x x + A_y y + A_z z  - d = 0\]</div>
</div>
<p>Describing a plane with normal vector <span class="math notranslate nohighlight">\(\hat{n} = (A_x,A_y,A_z)\)</span> and located at a distance <span class="math notranslate nohighlight">\(d\)</span> from the origin.
Alternatively, can write the surface equation with <span class="math notranslate nohighlight">\(R=0\)</span> so that</p>
<div class="math-wrapper docutils container" id="eq-surfaceplane2">
<span id="equation-eq-surfaceplane2"></span><div class="math notranslate nohighlight" id="eq-surfaceplane2">
<span id="equation-eq-surfaceplane2"></span><span class="eqno">(7)<a class="headerlink" href="#eq-surfaceplane2" title="Permalink to this equation">#</a></span>\[S(\vec{x})= A_x (x-Q_x) + A_y(y-Q_y) + A_z (z-Q_z) = 0\]</div>
</div>
<p>with the perpendicular distance from the origin as <span class="math notranslate nohighlight">\(A \cdot Q = d\)</span>.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/Plane.png"><img alt="Logo" src="../_images/Plane.png" style="width: 216.0px; height: 216.0px;" /></a>
</figure>
<p>An example input for a plane with the normal <span class="math notranslate nohighlight">\(\hat{n}=(0,1,0)\)</span>, located at a distance <span class="math notranslate nohighlight">\(L_y\)</span> from the origin,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;comment&quot;</span><span class="p">:</span>      <span class="s2">&quot;Plane BC&quot;</span><span class="p">,</span>
  <span class="s2">&quot;Q&quot;</span><span class="p">:</span>            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
  <span class="s2">&quot;aInv&quot;</span><span class="p">:</span>         <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
  <span class="s2">&quot;P&quot;</span><span class="p">:</span>            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
  <span class="s2">&quot;R&quot;</span><span class="p">:</span>            <span class="n">Ly</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p><strong>Sphere</strong></p></li>
</ol>
<blockquote>
<div><p>To construct a sphere, <span class="math notranslate nohighlight">\(p_x=p_y=p_z=p_R=2\)</span>,
<span class="math notranslate nohighlight">\(A_x=A_y=A_z=1\)</span> and <span class="math notranslate nohighlight">\(R\neq0\)</span> to give the surface equation</p>
<div class="math-wrapper docutils container" id="eq-surfacesphere">
<span id="equation-eq-surfacesphere"></span><div class="math notranslate nohighlight" id="eq-surfacesphere">
<span id="equation-eq-surfacesphere"></span><span class="eqno">(8)<a class="headerlink" href="#eq-surfacesphere" title="Permalink to this equation">#</a></span>\[S(\vec{x})= \left(x-Q_x\right)^2 + \left(y-Q_y\right)^2 + \left(z-Q_z\right)^2  - R^2 = 0\]</div>
</div>
<p>Describing a sphere centred at <span class="math notranslate nohighlight">\(\vec{Q} = (Q_x,Q_y,Q_z)\)</span> with a radius <span class="math notranslate nohighlight">\(R\)</span>.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/Sphere.png"><img alt="Logo" src="../_images/Sphere.png" style="width: 216.0px; height: 216.0px;" /></a>
</figure>
<p>An example input for a sphere with the centre coordinate <span class="math notranslate nohighlight">\(\vec{Q}=(Q_x,Q_y,Q_z)\)</span> can be constructed with the input parameters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;comment&quot;</span><span class="p">:</span>      <span class="s2">&quot;Sphere BC&quot;</span><span class="p">,</span>
  <span class="s2">&quot;Q&quot;</span><span class="p">:</span>            <span class="p">[</span><span class="n">Qx</span><span class="p">,</span> <span class="n">Qy</span><span class="p">,</span> <span class="n">Qz</span><span class="p">],</span>
  <span class="s2">&quot;aInv&quot;</span><span class="p">:</span>         <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
  <span class="s2">&quot;P&quot;</span><span class="p">:</span>            <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
  <span class="s2">&quot;R&quot;</span><span class="p">:</span>            <span class="n">radius</span> <span class="n">of</span> <span class="n">sphere</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p><strong>Ellipsoid</strong></p></li>
</ol>
<blockquote>
<div><p>To construct an ellipsoid, <span class="math notranslate nohighlight">\(p_x=p_y=p_z=p_R=2\)</span> and
<span class="math notranslate nohighlight">\(A_x=\frac{1}{a}, A_z=\frac{1}{b}, A_z=\frac{1}{c}\)</span> and <span class="math notranslate nohighlight">\(R=1\)</span> to give the surface equation</p>
<div class="math-wrapper docutils container" id="eq-surfaceellipsoid">
<span id="equation-eq-surfaceellipsoid"></span><div class="math notranslate nohighlight" id="eq-surfaceellipsoid">
<span id="equation-eq-surfaceellipsoid"></span><span class="eqno">(9)<a class="headerlink" href="#eq-surfaceellipsoid" title="Permalink to this equation">#</a></span>\[S(\vec{x})= \left(\frac{x-Q_x}{a}\right)^2 + \left(\frac{y-Q_y}{b}\right)^2 + \left(\frac{z-Q_z}{c}\right)^2  - 1 = 0\]</div>
</div>
<p>Describing an ellipsoid centred at <span class="math notranslate nohighlight">\(\vec{Q} = (Q_x,Q_y,Q_z)\)</span> with principle semi-axes <span class="math notranslate nohighlight">\(a, b, c\)</span>.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/Ellipsoid.png"><img alt="Logo" src="../_images/Ellipsoid.png" style="width: 216.0px; height: 216.0px;" /></a>
</figure>
<p>An example ellipsoid input,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;comment&quot;</span><span class="p">:</span>      <span class="s2">&quot;Ellipsoid BC&quot;</span><span class="p">,</span>
  <span class="s2">&quot;Q&quot;</span><span class="p">:</span>            <span class="p">[</span><span class="n">Qx</span><span class="p">,</span> <span class="n">Qy</span><span class="p">,</span> <span class="n">Qz</span><span class="p">],</span>
  <span class="s2">&quot;aInv&quot;</span><span class="p">:</span>         <span class="p">[</span><span class="mi">1</span><span class="o">/</span><span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">b</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">c</span><span class="p">],</span>
  <span class="s2">&quot;P&quot;</span><span class="p">:</span>            <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
  <span class="s2">&quot;R&quot;</span><span class="p">:</span>            <span class="mi">1</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="4">
<li><p><strong>Cylinder</strong></p></li>
</ol>
<blockquote>
<div><p>A cylinder aligned along <span class="math notranslate nohighlight">\(\hat{e}_z\)</span> can be constructed using <span class="math notranslate nohighlight">\(p_x=p_y=p_R=2\)</span>, <span class="math notranslate nohighlight">\(A_x=A_y=1, A_z=0\)</span> and <span class="math notranslate nohighlight">\(R\neq 0\)</span>.</p>
<div class="math-wrapper docutils container" id="eq-surfacecylinder">
<span id="equation-eq-surfacecylinder"></span><div class="math notranslate nohighlight" id="eq-surfacecylinder">
<span id="equation-eq-surfacecylinder"></span><span class="eqno">(10)<a class="headerlink" href="#eq-surfacecylinder" title="Permalink to this equation">#</a></span>\[S(\vec{x})= \left(x-Q_x\right)^2 + \left(y-Q_y\right)^2 - R^2 = 0\]</div>
</div>
<p>Describing an cylinder centred at <span class="math notranslate nohighlight">\(\vec{Q} = (Q_x,Q_y)\)</span> on the <span class="math notranslate nohighlight">\(xy\)</span> plane with radius <span class="math notranslate nohighlight">\(R\)</span>.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/Cylinder.png"><img alt="Logo" src="../_images/Cylinder.png" style="width: 223.2px; height: 209.4px;" /></a>
</figure>
<p>An example cylinder input,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;comment&quot;</span><span class="p">:</span>      <span class="s2">&quot;Cylinder BC&quot;</span><span class="p">,</span>
  <span class="s2">&quot;Q&quot;</span><span class="p">:</span>            <span class="p">[</span><span class="n">Qx</span><span class="p">,</span> <span class="n">Qy</span><span class="p">,</span> <span class="n">Qz</span><span class="p">],</span>
  <span class="s2">&quot;aInv&quot;</span><span class="p">:</span>         <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
  <span class="s2">&quot;P&quot;</span><span class="p">:</span>            <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
  <span class="s2">&quot;R&quot;</span><span class="p">:</span>            <span class="n">radius</span> <span class="n">of</span> <span class="n">cylinder</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" id="squircle" start="5">
<li><p><strong>Squircle</strong></p></li>
</ol>
<blockquote>
<div><p>A squircle is a surface that is intermediate between a sphere and a cube.
The construction of a squircle has <span class="math notranslate nohighlight">\(p_x=p_y=p_z=p_R=4\)</span> and <span class="math notranslate nohighlight">\(A_x=A_y=A_z=1\)</span></p>
<div class="math-wrapper docutils container" id="eq-surfacesquircle">
<span id="equation-eq-surfacesquircle"></span><div class="math notranslate nohighlight" id="eq-surfacesquircle">
<span id="equation-eq-surfacesquircle"></span><span class="eqno">(11)<a class="headerlink" href="#eq-surfacesquircle" title="Permalink to this equation">#</a></span>\[S(\vec{x})= \left(x-Q_x\right)^4 + \left(y-Q_y\right)^4 + \left(z-Q_z\right)^4  - R^4 = 0\]</div>
</div>
<p>Describing a squircle centred at <span class="math notranslate nohighlight">\(\vec{Q} = (Q_x,Q_y,Q_z)\)</span> with a minor radius <span class="math notranslate nohighlight">\(R\)</span>.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/Squircle.png"><img alt="Logo" src="../_images/Squircle.png" style="width: 216.0px; height: 216.0px;" /></a>
</figure>
<p>An example squircle input,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;comment&quot;</span><span class="p">:</span>      <span class="s2">&quot;Squircle BC&quot;</span><span class="p">,</span>
  <span class="s2">&quot;Q&quot;</span><span class="p">:</span>            <span class="p">[</span><span class="n">Qx</span><span class="p">,</span> <span class="n">Qy</span><span class="p">,</span> <span class="n">Qz</span><span class="p">],</span>
  <span class="s2">&quot;aInv&quot;</span><span class="p">:</span>         <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
  <span class="s2">&quot;P&quot;</span><span class="p">:</span>            <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
  <span class="s2">&quot;R&quot;</span><span class="p">:</span>            <span class="n">Minor</span> <span class="n">radius</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="6">
<li><p><strong>Superellipsoid</strong></p></li>
</ol>
<blockquote>
<div><p>A superellipse is a closed surface that resembles an ellipse, featuring a semi-major axis and semi-minor axis, but with different shape.
The construction of a superellipse has <span class="math notranslate nohighlight">\(p_x=p_y=p_z=p_R=n\)</span> and
<span class="math notranslate nohighlight">\(A_x=\frac{1}{a}, A_z=\frac{1}{b}, A_z=\frac{1}{c}\)</span> and <span class="math notranslate nohighlight">\(R=1\)</span>.
A super ellipsoid provide an increasingly closer approximation to a cuboid for large positive <span class="math notranslate nohighlight">\(n\)</span>.</p>
<div class="math-wrapper docutils container" id="eq-surfacesuperellipsoid">
<span id="equation-eq-surfacesuperellipsoid"></span><div class="math notranslate nohighlight" id="eq-surfacesuperellipsoid">
<span id="equation-eq-surfacesuperellipsoid"></span><span class="eqno">(12)<a class="headerlink" href="#eq-surfacesuperellipsoid" title="Permalink to this equation">#</a></span>\[S(\vec{x})= \left(\frac{x-Q_x}{a}\right)^n + \left(\frac{y-Q_y}{b}\right)^n + \left(\frac{z-Q_z}{c}\right)^n  - 1 = 0\]</div>
</div>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/SuperEllipsoid.png"><img alt="Logo" src="../_images/SuperEllipsoid.png" style="width: 216.0px; height: 216.0px;" /></a>
</figure>
<p>An example superellipsoid input,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;comment&quot;</span><span class="p">:</span>      <span class="s2">&quot;Superellipsoid BC&quot;</span><span class="p">,</span>
  <span class="s2">&quot;Q&quot;</span><span class="p">:</span>            <span class="p">[</span><span class="n">Qx</span><span class="p">,</span> <span class="n">Qy</span><span class="p">,</span> <span class="n">Qz</span><span class="p">],</span>
  <span class="s2">&quot;aInv&quot;</span><span class="p">:</span>         <span class="p">[</span><span class="mi">1</span><span class="o">/</span><span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">b</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">c</span><span class="p">],</span>
  <span class="s2">&quot;P&quot;</span><span class="p">:</span>            <span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">],</span>
  <span class="s2">&quot;R&quot;</span><span class="p">:</span>            <span class="mi">1</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="additional-surface-forms">
<h4>Additional surface forms<a class="headerlink" href="#additional-surface-forms" title="Permalink to this heading">#</a></h4>
<p>MPCD boundaries are versatile and many possible surface geometries can be implemented.</p>
<section id="wavy-surfaces">
<h5>Wavy surfaces<a class="headerlink" href="#wavy-surfaces" title="Permalink to this heading">#</a></h5>
<p>Modulated planes, spheres and cylinders can be created with surface equations <span class="math notranslate nohighlight">\(S(\vec{x})=S^S(\vec{x})+S^W(\vec{x})\)</span>, combining standard surfaces <span class="math notranslate nohighlight">\(S^{S}(\vec{x})\)</span> with a wavy component <span class="math notranslate nohighlight">\(S^{W}(\vec{x})\)</span> <a class="reference internal" href="../References/References.html#wamsler2023" id="id23"><span>[Wamsler2023]</span></a>.
For a surface indexed by <span class="math notranslate nohighlight">\(b\)</span>, wavy surfaces are implemented with the form</p>
<div class="math-wrapper docutils container" id="eq-surfacewavy">
<span id="equation-eq-surfacewavy"></span><div class="math notranslate nohighlight" id="eq-surfacewavy">
<span id="equation-eq-surfacewavy"></span><span class="eqno">(13)<a class="headerlink" href="#eq-surfacewavy" title="Permalink to this equation">#</a></span>\[S^{W}_b(\vec{x})= B_{b,0}\cos(B_{b,1}S_{b,1}(\vec{x}))\cos(B_{b,2}S_{b,2}(\vec{x}))\]</div>
</div>
<p>where <span class="math notranslate nohighlight">\(B_{b,0}\)</span> is a modulation amplitude, <span class="math notranslate nohighlight">\(B_{b,1}\)</span> and <span class="math notranslate nohighlight">\(B_{b,2}\)</span>
are modulation frequencies, and <span class="math notranslate nohighlight">\(S_{b,1}\)</span> and <span class="math notranslate nohighlight">\(S_{b,2}\)</span> define the orientation of the modulation.
By setting one of <span class="math notranslate nohighlight">\(B_{b,1}\)</span> and <span class="math notranslate nohighlight">\(B_{b,2}\)</span> to zero, surfaces can be given waves in one axis (corrugated),
while when both frequencies are non-zero, surfaces take on double modulated surfaces.</p>
<p>The wavy surfaces can be used in the input scripts as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;comment&quot;</span><span class="p">:</span>              <span class="s2">&quot;Wavy BC&quot;</span><span class="p">,</span>
  <span class="n">Wavy</span>  <span class="p">[</span><span class="n">B0</span><span class="p">,</span><span class="n">B1</span><span class="p">,</span><span class="n">B2</span><span class="p">]</span>        <span class="s2">&quot;B0 = amplitube, B1,B2 = wave frequencies&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Depending on the combined <a class="reference internal" href="#eq-surface"><span class="std std-ref">standard surface</span></a> <span class="math notranslate nohighlight">\(S^{S}(\vec{x})\)</span>,
the orientation equations <span class="math notranslate nohighlight">\(S_{b,1}(\vec{x})\)</span> and <span class="math notranslate nohighlight">\(S_{b,2}(\vec{x})\)</span> are given different forms, as outlined below.</p>
<ol class="arabic simple">
<li><p><strong>Wavy planes</strong></p></li>
</ol>
<blockquote>
<div><p>For wavy planes, the orientation functions take the form</p>
<div class="math-wrapper docutils container" id="eq-planewavys1">
<span id="equation-eq-planewavys1"></span><div class="math notranslate nohighlight" id="eq-planewavys1">
<span id="equation-eq-planewavys1"></span><span class="eqno">(14)<a class="headerlink" href="#eq-planewavys1" title="Permalink to this equation">#</a></span>\[\begin{split}S_{b,1}(\vec{x}) &amp;= \frac{A_y x - A_x y}{\sqrt{A_x^2+ A_y^2}} \\
S_{b,2}(\vec{x}) &amp;= \frac{A_x A_z x + A_y A_z y - (A_x^2 + A_y^2) z}{\sqrt{A_x^4 + A_y^4 + 2 A_x^2 A_z^2 + 2 A_y^2 A_z^2 + 2 A_x^2 A_y^2}}\end{split}\]</div>
</div>
<p>where <span class="math notranslate nohighlight">\(S_{b,1}\)</span> generates longitudinal waves (number set by the frequency <span class="math notranslate nohighlight">\(B_{b,1}\)</span>) and <span class="math notranslate nohighlight">\(S_{b,2}(\vec{x})\)</span> creates latitudinal waves (number set by the frequency <span class="math notranslate nohighlight">\(B_{b,2}\neq0\)</span>).</p>
<p>The accompanying standard surface <span class="math notranslate nohighlight">\(S^S(\vec{x})\)</span>, defines the <a class="reference internal" href="#eq-surfaceplane1"><span class="std std-ref">plane</span></a>.</p>
<div class="table-wrapper colwidths-given docutils container">
<table class="docutils align-center">
<colgroup>
<col style="width: 50.0%" />
<col style="width: 50.0%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><a class="reference internal image-reference" href="../_images/WavyPlane.png"><img alt="../_images/WavyPlane.png" class="align-center" src="../_images/WavyPlane.png" style="width: 95%;" /></a>
</td>
<td><a class="reference internal image-reference" href="../_images/EggPlane.png"><img alt="../_images/EggPlane.png" class="align-center" src="../_images/EggPlane.png" style="width: 95%;" /></a>
</td>
</tr>
<tr class="row-even"><td><p>Corrugated plane for either <span class="math notranslate nohighlight">\(B_{b,1}\neq 0\)</span> or <span class="math notranslate nohighlight">\(B_{b,2}\neq 0\)</span>.</p>
<p>This example has <span class="math notranslate nohighlight">\(B_{b,0} = 0.2\)</span>, <span class="math notranslate nohighlight">\(B_{b,1} = 10\)</span>, <span class="math notranslate nohighlight">\(B_{b,2} = 0\)</span> and <span class="math notranslate nohighlight">\(\vec{A}=(0,1,0)\)</span>, to define a plane with normal in <span class="math notranslate nohighlight">\(\hat{y}\)</span> that has transverse modulation in <span class="math notranslate nohighlight">\(\hat{x}\)</span> direction with amplitude <span class="math notranslate nohighlight">\(0.2\)</span>.</p>
</td>
<td><p>Egg carton plane for both <span class="math notranslate nohighlight">\(B_{b,1}\neq 0\)</span> and <span class="math notranslate nohighlight">\(B_{b,2}\neq 0\)</span>. This example has <span class="math notranslate nohighlight">\(B_{b,0} = 0.2\)</span>, <span class="math notranslate nohighlight">\(B_{b,1} = 10\)</span>, <span class="math notranslate nohighlight">\(B_{b,2} = 10\)</span> and <span class="math notranslate nohighlight">\(\vec{A}=(0,1,0)\)</span>, to define a plane with normal in <span class="math notranslate nohighlight">\(\hat{y}\)</span> that has transverse modulation in <span class="math notranslate nohighlight">\(\hat{x}\)</span> and <span class="math notranslate nohighlight">\(\hat{z}\)</span> direction with amplitude <span class="math notranslate nohighlight">\(0.2\)</span>.</p></td>
</tr>
</tbody>
</table>
</div>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p><strong>Wavy spheres</strong></p></li>
</ol>
<blockquote>
<div><p>For wavy spheres, the orientation functions take the form</p>
<div class="math-wrapper docutils container" id="eq-spherewavys1">
<span id="equation-eq-spherewavys1"></span><div class="math notranslate nohighlight" id="eq-spherewavys1">
<span id="equation-eq-spherewavys1"></span><span class="eqno">(15)<a class="headerlink" href="#eq-spherewavys1" title="Permalink to this equation">#</a></span>\[\begin{split}\tan S_{b,1}(\vec{x}) &amp;= \frac{A_y y - Q_y}{A_x x - Q_x} \\
\tan S_{b,2}(\vec{x}) &amp;= \frac{\sqrt{A_x^2(x-Q_x)^2 + A_y^2(y-Q_y)^2}}{A_z(z-Q_z)}\end{split}\]</div>
</div>
<p>where <span class="math notranslate nohighlight">\(S_{b,1}\)</span> generates longitudinal waves (number set by the frequency <span class="math notranslate nohighlight">\(B_{b,1}\)</span>) and <span class="math notranslate nohighlight">\(S_{b,2}(\vec{x})\)</span> creates latitudinal waves (number set by the frequency <span class="math notranslate nohighlight">\(B_{b,2}\neq0\)</span>).</p>
<p>The accompanying standard surface <span class="math notranslate nohighlight">\(S^S(\vec{x})\)</span>, defines the <a class="reference internal" href="#eq-surfacesphere"><span class="std std-ref">sphere</span></a>.</p>
<div class="table-wrapper colwidths-given docutils container">
<table class="docutils align-center">
<colgroup>
<col style="width: 33.3%" />
<col style="width: 33.3%" />
<col style="width: 33.3%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><a class="reference internal image-reference" href="../_images/LatitudeSphere.png"><img alt="../_images/LatitudeSphere.png" class="align-center" src="../_images/LatitudeSphere.png" style="width: 95%;" /></a>
</td>
<td><a class="reference internal image-reference" href="../_images/LongitudinalSphere.png"><img alt="../_images/LongitudinalSphere.png" class="align-center" src="../_images/LongitudinalSphere.png" style="width: 95%;" /></a>
</td>
<td><a class="reference internal image-reference" href="../_images/eggCartonSphere.png"><img alt="../_images/eggCartonSphere.png" class="align-center" src="../_images/eggCartonSphere.png" style="width: 95%;" /></a>
</td>
</tr>
<tr class="row-even"><td><p>Latitudinal waves for <span class="math notranslate nohighlight">\(B_{b,1} = 0\)</span> and <span class="math notranslate nohighlight">\(B_{b,2}\neq 0\)</span>. This example has <span class="math notranslate nohighlight">\(B_{b,0} = 0.2\)</span>, <span class="math notranslate nohighlight">\(B_{b,1} = 0\)</span>, <span class="math notranslate nohighlight">\(B_{b,2} = 10\)</span> <em>and</em> <span class="math notranslate nohighlight">\(\vec{A}=(1,1,1)\)</span>, to define a sphere that has latitudinal modulation with amplitude <span class="math notranslate nohighlight">\(0.2\)</span>.</p></td>
<td><p>Longitudinal waves for <span class="math notranslate nohighlight">\(B_{b,1} \neq 0\)</span> and <span class="math notranslate nohighlight">\(B_{b,2} = 0\)</span>. This example has <span class="math notranslate nohighlight">\(B_{b,0} = 0.2\)</span>, <span class="math notranslate nohighlight">\(B_{b,1} = 10\)</span>, <span class="math notranslate nohighlight">\(B_{b,2} = 0\)</span> and <span class="math notranslate nohighlight">\(\vec{A}=(1,1,1)\)</span>, to define a sphere that has longitudinal modulation with amplitude <span class="math notranslate nohighlight">\(0.2\)</span>.</p></td>
<td><p>Egg carton waves for <span class="math notranslate nohighlight">\(B_{b,1} \neq 0\)</span> and <span class="math notranslate nohighlight">\(B_{b,2} \neq 0\)</span>. This example has <span class="math notranslate nohighlight">\(B_{b,0} = 0.2\)</span>, <span class="math notranslate nohighlight">\(B_{b,1} = 10\)</span>, <span class="math notranslate nohighlight">\(B_{b,2} = 10\)</span> and <span class="math notranslate nohighlight">\(\vec{A}=(1,1,1)\)</span>, to define a sphere that has both latitudinal and longitudinal modulation with amplitude <span class="math notranslate nohighlight">\(0.2\)</span>.</p></td>
</tr>
</tbody>
</table>
</div>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p><strong>Wavy cylinders</strong></p></li>
</ol>
<blockquote>
<div><p>The two orientation functions <span class="math notranslate nohighlight">\(S_{b,1}(\vec{x})\)</span> and <span class="math notranslate nohighlight">\(S_{b,2}(\vec{x})\)</span> have cylic properties with respect to cylinder orientation along the cartesian direction <span class="math notranslate nohighlight">\(\hat{x},\hat{y},\hat{z}\)</span>.</p>
<p>If the cylinder is oriented in the</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\hat{x}\)</span>-direction, then <span class="math notranslate nohighlight">\(A_x=0\)</span> and <span class="math notranslate nohighlight">\((i,j,k)=(x,y,z)\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\hat{y}\)</span>-direction, then <span class="math notranslate nohighlight">\(A_y=0\)</span> and <span class="math notranslate nohighlight">\((i,j,k)=(y,z,x)\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\hat{z}\)</span>-direction, then <span class="math notranslate nohighlight">\(A_z=0\)</span> and <span class="math notranslate nohighlight">\((i,j,k)=(z,x,y)\)</span></p></li>
</ul>
<p>The orientation functions then take the form,</p>
<div class="math-wrapper docutils container" id="eq-spherewavys2">
<span id="equation-eq-spherewavys2"></span><div class="math notranslate nohighlight" id="eq-spherewavys2">
<span id="equation-eq-spherewavys2"></span><span class="eqno">(16)<a class="headerlink" href="#eq-spherewavys2" title="Permalink to this equation">#</a></span>\[\begin{split}\tan S_{b,1}(\vec{x}) &amp;= \frac{A_k x_k - Q_k}{A_j x_j - Q_j} \\
\tan S_{b,2}(\vec{x}) &amp;= \frac{\sqrt{A_j^2(x_j-Q_j)^2 + A_k^2(x_k-Q_k)^2}}{A_i(x_i-Q_i)}\end{split}\]</div>
</div>
<p>The accompanying standard surface <span class="math notranslate nohighlight">\(S^S(\vec{x})\)</span>, defining the <a class="reference internal" href="#eq-surfacecylinder"><span class="std std-ref">cylinder</span></a>, has the following form under the cyclic axes,</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[S^S(\vec{x}) = \left(x_j-Q_j \right )^2 + \left(x_k-Q_k \right)^2 - R^2 = 0\]</div>
</div>
<div class="table-wrapper colwidths-given docutils container">
<table class="docutils align-center">
<colgroup>
<col style="width: 33.3%" />
<col style="width: 33.3%" />
<col style="width: 33.3%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><a class="reference internal image-reference" href="../_images/LatitudeCylinder.png"><img alt="../_images/LatitudeCylinder.png" class="align-center" src="../_images/LatitudeCylinder.png" style="width: 95%;" /></a>
</td>
<td><a class="reference internal image-reference" href="../_images/LongitudinalCylinder.png"><img alt="../_images/LongitudinalCylinder.png" class="align-center" src="../_images/LongitudinalCylinder.png" style="width: 95%;" /></a>
</td>
<td><a class="reference internal image-reference" href="../_images/eggCartonCylinder.png"><img alt="../_images/eggCartonCylinder.png" class="align-center" src="../_images/eggCartonCylinder.png" style="width: 95%;" /></a>
</td>
</tr>
<tr class="row-even"><td><p>Latitudinal waves on cylinder for <span class="math notranslate nohighlight">\(B_{b,1} = 0\)</span> and <span class="math notranslate nohighlight">\(B_{b,2} \neq 0\)</span>. This example has <span class="math notranslate nohighlight">\(B_{b,0} = 0.2\)</span>, <span class="math notranslate nohighlight">\(B_{b,1} = 0\)</span>, <span class="math notranslate nohighlight">\(B_{b,2} = 10\)</span> and <span class="math notranslate nohighlight">\(\vec{A}=(1,1,0)\)</span>, to define a cylinder that has latitudinal modulation with amplitude <span class="math notranslate nohighlight">\(0.2\)</span>.</p></td>
<td><p>Longitudinal waves on cylinder for <span class="math notranslate nohighlight">\(B_{b,1} \neq 0\)</span> and <span class="math notranslate nohighlight">\(B_{b,2} = 0\)</span>. This example has <span class="math notranslate nohighlight">\(B_{b,0} = 0.2\)</span>, <span class="math notranslate nohighlight">\(B_{b,1} = 10\)</span>, <span class="math notranslate nohighlight">\(B_{b,2} = 0\)</span> and <span class="math notranslate nohighlight">\(\vec{A}=(1,1,0)\)</span>, to define a cylinder that has longitudinal modulation with amplitude <span class="math notranslate nohighlight">\(0.2\)</span>.</p></td>
<td><p>Egg-carton waves on cylinder for <span class="math notranslate nohighlight">\(B_{b,1} \neq 0\)</span> and <span class="math notranslate nohighlight">\(B_{b,2} \neq 0\)</span>. This example has <span class="math notranslate nohighlight">\(B_{b,0} = 0.2\)</span>, <span class="math notranslate nohighlight">\(B_{b,1} = 10\)</span>, <span class="math notranslate nohighlight">\(B_{b,2} = 10\)</span> and <span class="math notranslate nohighlight">\(\vec{A}=(1,1,0)\)</span>, to define a cylinder that has both latitudinal and longitudinal modulation with amplitude <span class="math notranslate nohighlight">\(0.2\)</span>.</p></td>
</tr>
</tbody>
</table>
</div>
</div></blockquote>
</section>
</section>
</section>
<section id="boundary-rules">
<span id="subsection-boundaryrules"></span><h3>Boundary rules<a class="headerlink" href="#boundary-rules" title="Permalink to this heading">#</a></h3>
<section id="requirements">
<h4>Requirements<a class="headerlink" href="#requirements" title="Permalink to this heading">#</a></h4>
<p>The implicit representation for the surface has the property that</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(S(\vec{x}) &gt; 0\)</span>, a point is <strong>outside</strong> the surface</p></li>
<li><p><span class="math notranslate nohighlight">\(S(\vec{x}) = 0\)</span>, a point is <strong>on</strong> the surface</p></li>
<li><p><span class="math notranslate nohighlight">\(S(\vec{x}) &lt; 0\)</span>, a point is <strong>inside</strong> the surface.</p></li>
</ul>
<p>Following a streaming step, boundary conditions are applied to an MPCD particle if the particle has passed inside a boundary.
For a particle <span class="math notranslate nohighlight">\(i\)</span> with position <span class="math notranslate nohighlight">\(\vec{x}_i\)</span> this condition is</p>
<div class="math-wrapper docutils container" id="eq-bccondition">
<span id="equation-eq-bccondition"></span><div class="math notranslate nohighlight" id="eq-bccondition">
<span id="equation-eq-bccondition"></span><span class="eqno">(17)<a class="headerlink" href="#eq-bccondition" title="Permalink to this equation">#</a></span>\[S(\vec{x}_i) \leq 0\]</div>
</div>
<p>Boundary conditions are only applied to a particle when the position is exactly on the surface,
which requires tracing back the particle’s position <span class="math notranslate nohighlight">\(\vec{x}_i^*\)</span> to where <span class="math notranslate nohighlight">\(S(\vec{x}_i^*) = 0\)</span>
at time <span class="math notranslate nohighlight">\(t^*\)</span> where <span class="math notranslate nohighlight">\(0&lt;t^*&lt;\delta t\)</span>.
Following boundary rules, the particle resumes streaming for the remaining time <span class="math notranslate nohighlight">\(\delta t-t^*\)</span>.</p>
</section>
<section id="boundary-operators">
<h4>Boundary operators<a class="headerlink" href="#boundary-operators" title="Permalink to this heading">#</a></h4>
<p>Boundary rules are operators on a particle’s position <span class="math notranslate nohighlight">\(\vec{x}_i\)</span>, velocity <span class="math notranslate nohighlight">\(\vec{v}_i\)</span> or orientation properties <span class="math notranslate nohighlight">\(\hat{u}_i\)</span>.</p>
<p>For a general property <span class="math notranslate nohighlight">\(\vec{f}_i (t)\)</span>, the rules have the following form</p>
<div class="math-wrapper docutils container" id="eq-bcoperators1">
<span id="equation-eq-bcoperators1"></span><div class="math notranslate nohighlight" id="eq-bcoperators1">
<span id="equation-eq-bcoperators1"></span><span class="eqno">(18)<a class="headerlink" href="#eq-bcoperators1" title="Permalink to this equation">#</a></span>\[\vec{f}_i(t&gt;t^*) \: \text{+=} \: D_{f,\hat{\nu}}\hat{\nu}\]</div>
</div>
<div class="math-wrapper docutils container" id="eq-bcoperators2">
<span id="equation-eq-bcoperators2"></span><div class="math notranslate nohighlight" id="eq-bcoperators2">
<span id="equation-eq-bcoperators2"></span><span class="eqno">(19)<a class="headerlink" href="#eq-bcoperators2" title="Permalink to this equation">#</a></span>\[\vec{f}_i(t&gt;t^*) \: \text{+=} \: M_{f,\hat{\nu}} \vec{f}_{i,\hat{\nu}}(t&lt;t^*)\]</div>
</div>
<p>where <span class="math notranslate nohighlight">\(\hat{\nu}\)</span> are implemented as each of the cartesian axes <span class="math notranslate nohighlight">\(\hat{x},\hat{y},\hat{z}\)</span>, the local surface normal <span class="math notranslate nohighlight">\(\hat{n}\)</span> and the local surface tangent <span class="math notranslate nohighlight">\(\hat{t}\)</span>.
The properties before and after the boundary rules are applied are <span class="math notranslate nohighlight">\(\vec{f}_i(t&lt;t^*)\)</span> and <span class="math notranslate nohighlight">\(\vec{f}_i(t&gt;t^*)\)</span>.
The <a class="reference internal" href="#eq-bcoperators1"><span class="std std-ref">shift operator</span></a> is an additive shift on vector <span class="math notranslate nohighlight">\(\vec{f}_i\)</span> in direction <span class="math notranslate nohighlight">\(\hat{\nu}\)</span> with magnitude <span class="math notranslate nohighlight">\(D_{f,\hat{\nu}}\)</span>
and the <a class="reference internal" href="#eq-bcoperators2"><span class="std std-ref">multiplier operator</span></a> <span class="math notranslate nohighlight">\(M_{f,\hat{\nu}}\)</span> acts on the projection <span class="math notranslate nohighlight">\(\vec{f}_{i,\hat{\nu}}\)</span> of the property <span class="math notranslate nohighlight">\(\vec{f}_i\)</span> in the direction <span class="math notranslate nohighlight">\(\hat{\nu}\)</span>.</p>
<section id="examples">
<h5>Examples<a class="headerlink" href="#examples" title="Permalink to this heading">#</a></h5>
<p>Defaults for no applied conditions are <span class="math notranslate nohighlight">\(D_{f,\hat{\nu}} = 0\)</span> and <span class="math notranslate nohighlight">\(M_{f,\hat{\nu}} = 1\)</span>,
leaving all components of <span class="math notranslate nohighlight">\(f_i\)</span> unchanged and without shifts.
The default operator values in the input scripts are shown below, which can be edited to define particular boundary condition.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;comment&quot;</span><span class="p">:</span>      <span class="s2">&quot;position operators&quot;</span><span class="p">,</span>
  <span class="n">DN</span>  <span class="mi">0</span>           <span class="s2">&quot;position shift in normal direction&quot;</span><span class="p">,</span>
  <span class="n">DT</span>  <span class="mi">0</span>           <span class="s2">&quot;position shift in tangential direction&quot;</span><span class="p">,</span>

  <span class="s2">&quot;comment&quot;</span><span class="p">:</span>      <span class="s2">&quot;velocity operators&quot;</span><span class="p">,</span>
  <span class="n">DVN</span> <span class="mi">0</span>           <span class="s2">&quot;velocity added in the normal direction&quot;</span><span class="p">,</span>
  <span class="n">DVT</span> <span class="mi">0</span>           <span class="s2">&quot;velocity added in the tangential direction&quot;</span><span class="p">,</span>
  <span class="n">DVxyz</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>   <span class="s2">&quot;velocity added in the [x,y,z] cartesian directions&quot;</span><span class="p">,</span>

  <span class="n">MVN</span> <span class="mi">1</span>           <span class="s2">&quot;multiplies velocity in normal direction&quot;</span><span class="p">,</span>
  <span class="n">MVT</span> <span class="mi">1</span>           <span class="s2">&quot;multiplies velocity in tangential direction&quot;</span><span class="p">,</span>
  <span class="n">MVxyz</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>   <span class="s2">&quot;multiplies velocity in cartesian direction&quot;</span><span class="p">,</span>

  <span class="s2">&quot;comment&quot;</span><span class="p">:</span>      <span class="s2">&quot;orientation operators&quot;</span><span class="p">,</span>
  <span class="n">DUxyz</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>   <span class="s2">&quot;orientation added in the [x,y,z] cartesian directions&quot;</span><span class="p">,</span>
  <span class="n">MVN</span> <span class="mi">1</span>           <span class="s2">&quot;multiplies orientation in normal direction&quot;</span><span class="p">,</span>
  <span class="n">MVT</span> <span class="mi">1</span>           <span class="s2">&quot;multiplies orientation in tangential direction&quot;</span><span class="p">,</span>
  <span class="n">MVxyz</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>   <span class="s2">&quot;multiplies velocity in cartesian direction&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Commonly used boundary rules are:</p>
<ol class="arabic simple">
<li><p><strong>Position</strong></p></li>
</ol>
<blockquote>
<div><p><strong>Periodic boundary conditions</strong></p>
<p>Extended geometries, such as open systems or channel flows, often use periodic boundary conditions.
Periodic boundary conditions makes it possible to approximate an infinite system by wrapping coordinates around by their boundaries.
In order to achieve periodicity,
a planar boundary surface are created with <span class="math notranslate nohighlight">\(D_{x,\hat{n}}=L\)</span> as a shift equivalent to the system dimension.</p>
<figure class="align-center" id="id31">
<a class="reference internal image-reference" href="../_images/PBCschematic.png"><img alt="Logo" src="../_images/PBCschematic.png" style="width: 270.75px; height: 248.1px;" /></a>
<figcaption>
<p><span class="caption-text"><em>Example of a particle that passes through a through a periodic boundary.</em>
<em>The particle rewinds back to the point on the surface, and a shift is applied</em>
<em>in the surface normal direction that takes the particle to the left side.</em>
<em>There, the particle resumes streaming for time</em> <span class="math notranslate nohighlight">\(\delta t-t^*\)</span>.</span><a class="headerlink" href="#id31" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Periodic boundary conditions are implemented as the default boundary conditions (so no boundaries required in input scripts).
An example of the manual input for periodic boundary conditions on the left and right wall would be</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="s2">&quot;comment&quot;</span><span class="p">:</span>      <span class="s2">&quot;Left PBC&quot;</span><span class="p">,</span>
<span class="s2">&quot;phantom&quot;</span><span class="p">:</span>      <span class="mi">0</span><span class="p">,</span>              <span class="s2">&quot;Ghost particles turned off (only required for solid boundaries)&quot;</span><span class="p">,</span>
<span class="s2">&quot;Q&quot;</span><span class="p">:</span>            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>      <span class="s2">&quot;Located on left-hand side of simulation domain &quot;</span><span class="p">,</span>
<span class="s2">&quot;aInv&quot;</span><span class="p">:</span>         <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>      <span class="s2">&quot;Normal vector faces right-ward&quot;</span><span class="p">,</span>
<span class="s2">&quot;P&quot;</span><span class="p">:</span>            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>   <span class="s2">&quot;Surface power = 1 (plane)&quot;</span><span class="p">,</span>
<span class="s2">&quot;R&quot;</span><span class="p">:</span>            <span class="mi">0</span><span class="p">,</span>              <span class="s2">&quot;Position - easiest to set to zero if using Q to define distance from origin&quot;</span><span class="p">,</span>
<span class="s2">&quot;DN&quot;</span><span class="p">:</span>           <span class="n">Lx</span><span class="p">,</span>             <span class="s2">&quot;Shift particle position by Lx in the direction of surface normal (shift right by Lx)&quot;</span><span class="p">,</span>
<span class="s2">&quot;DT&quot;</span><span class="p">:</span>           <span class="mi">0</span><span class="p">,</span>              <span class="s2">&quot;No shift in tangent direction&quot;</span>
<span class="p">},</span>
<span class="p">{</span>
<span class="s2">&quot;comment&quot;</span><span class="p">:</span>      <span class="s2">&quot;Right PBC&quot;</span><span class="p">,</span>
<span class="s2">&quot;phantom&quot;</span><span class="p">:</span>      <span class="mi">0</span><span class="p">,</span>              <span class="s2">&quot;Ghost particles turned off (only required for solid boundaries)&quot;</span><span class="p">,</span>
<span class="s2">&quot;Q&quot;</span><span class="p">:</span>            <span class="p">[</span><span class="n">Lx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>     <span class="s2">&quot;Located on right-hand side of simulation domain &quot;</span><span class="p">,</span>
<span class="s2">&quot;aInv&quot;</span><span class="p">:</span>         <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>     <span class="s2">&quot;Normal vector faces left-ward&quot;</span><span class="p">,</span>
<span class="s2">&quot;P&quot;</span><span class="p">:</span>            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>   <span class="s2">&quot;Surface power = 1 (plane)&quot;</span><span class="p">,</span>
<span class="s2">&quot;R&quot;</span><span class="p">:</span>            <span class="mi">0</span><span class="p">,</span>              <span class="s2">&quot;Position - easiest to set to zero if using Q to define distance from origin&quot;</span><span class="p">,</span>
<span class="s2">&quot;DN&quot;</span><span class="p">:</span>           <span class="n">Lx</span><span class="p">,</span>             <span class="s2">&quot;Shift particle position by Lx in the direction of surface normal (shift left by Lx)&quot;</span><span class="p">,</span>
<span class="s2">&quot;DT&quot;</span><span class="p">:</span>           <span class="mi">0</span><span class="p">,</span>              <span class="s2">&quot;No shift in tangent direction&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p><strong>Velocity</strong></p></li>
</ol>
<blockquote>
<div><p><strong>Perfect-slip</strong></p>
<p>Perfect-slip rules are suitable for solid boundaries where viscous effects at the wall are negligible (shear stress at the boundary is zero).
Achieving perfect-slip utilises <em>reflective</em> boundary rules to the velocity.
The normal component of the velocity is reversed <span class="math notranslate nohighlight">\(M_{v,\hat{n}} = -1\)</span>,
while the tangential component is unchanged <span class="math notranslate nohighlight">\(M_{v,\hat{t}} = 1\)</span>.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/perfectslip.png"><img alt="Logo" src="../_images/perfectslip.png" style="width: 330.8px; height: 160.4px;" /></a>
</figure>
<p>In the input files, perfect slip can be enabled by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;comment&quot;</span><span class="p">:</span>          <span class="s2">&quot;Perfect slip BC&quot;</span><span class="p">,</span>
<span class="s2">&quot;MVN&quot;</span><span class="p">:</span>      <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
<span class="s2">&quot;MVT&quot;</span><span class="p">:</span>      <span class="mi">1</span><span class="p">,</span>
</pre></div>
</div>
<p><strong>No slip</strong></p>
<p>No-slip refers to any impermeable boundary condition that brings the velocity of the fluid to zero at the wall.
Achieving no-slip utilises <em>bounce-back</em> boundary rules to the velocity <a class="reference internal" href="../References/References.html#allahyarov2002" id="id24"><span>[Allahyarov2002]</span></a>,
reversing the normal and tangential component of the velocity so that <span class="math notranslate nohighlight">\(M_{v,\hat{n}} = M_{v,\hat{t}} = -1\)</span>.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/noslip.png"><img alt="Logo" src="../_images/noslip.png" style="width: 330.8px; height: 160.4px;" /></a>
</figure>
<p>In the input files, no-slip can be enabled by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;comment&quot;</span><span class="p">:</span>          <span class="s2">&quot;No-slip BC&quot;</span><span class="p">,</span>
<span class="s2">&quot;MVN&quot;</span><span class="p">:</span>      <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
<span class="s2">&quot;MVT&quot;</span><span class="p">:</span>      <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p><strong>Orientation</strong></p></li>
</ol>
<p>For liquid crystalline fluids, boundary conditions (or anchoring conditions)
can be applied so that the particle orientation <span class="math notranslate nohighlight">\(\hat{u}_i\)</span> aligns in the normal direction to the boundary (homeotropic)
or tangential with the boundary (planar).</p>
<blockquote>
<div><p><strong>Homeotropic</strong></p>
<p>Alignment normal to the boundary requires <span class="math notranslate nohighlight">\(M_{v,\hat{n}} = 1\)</span> and <span class="math notranslate nohighlight">\(M_{v,\hat{t}} = 0\)</span>.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/homeotropic.png"><img alt="Logo" src="../_images/homeotropic.png" style="width: 292.40000000000003px; height: 74.2px;" /></a>
</figure>
<p>In the input files, homeotropic anchoring can be enabled by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;comment&quot;</span><span class="p">:</span>          <span class="s2">&quot;Homeotropic anchoring&quot;</span><span class="p">,</span>
<span class="s2">&quot;MUN&quot;</span><span class="p">:</span>      <span class="mi">1</span><span class="p">,</span>
<span class="s2">&quot;MUT&quot;</span><span class="p">:</span>      <span class="mi">0</span><span class="p">,</span>
</pre></div>
</div>
<p><strong>Planar</strong></p>
<p>Alignment tangential to the boundary requires <span class="math notranslate nohighlight">\(M_{v,\hat{n}} = 0\)</span> and <span class="math notranslate nohighlight">\(M_{v,\hat{t}} = 1\)</span>.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/planar.png"><img alt="Logo" src="../_images/planar.png" style="width: 293.2px; height: 74.2px;" /></a>
</figure>
<p>In the input files, planar anchoring can be enabled by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;comment&quot;</span><span class="p">:</span>           <span class="s2">&quot;Planar anchoring&quot;</span><span class="p">,</span>
<span class="s2">&quot;MUN&quot;</span><span class="p">:</span>      <span class="mi">0</span><span class="p">,</span>
<span class="s2">&quot;MUT&quot;</span><span class="p">:</span>      <span class="mi">1</span><span class="p">,</span>
</pre></div>
</div>
</div></blockquote>
</section>
</section>
<section id="boundary-corrections">
<h4>Boundary corrections<a class="headerlink" href="#boundary-corrections" title="Permalink to this heading">#</a></h4>
<section id="ghost-particles">
<h5>Ghost particles<a class="headerlink" href="#ghost-particles" title="Permalink to this heading">#</a></h5>
<p>The random grid shifts (for Galilean invariance) can result in fluid cells being intersected by the boundary,
reducing the cell’s population below the average number density.
With fewer particles in the cell, the centre of mass velocity <span class="math notranslate nohighlight">\(\vec{v}^{\mathrm{cm}}_c\)</span> can fail to satisfy no-slip <a class="reference internal" href="../References/References.html#lamura2001" id="id25"><span>[Lamura2001]</span></a>.
A standard method to correct no-slip, so that <span class="math notranslate nohighlight">\(\vec{v}^{\mathrm{cm}}_c \approx 0\)</span>,
is to fill the cell with <span class="math notranslate nohighlight">\(N_\mathrm{ghost} =\langle N_c \rangle - N_c\)</span> virtual particles so that the effective cell density <span class="math notranslate nohighlight">\(N_c\)</span> is equal to the average density <span class="math notranslate nohighlight">\(\langle N_c \rangle\)</span>.</p>
<div class="math-wrapper docutils container" id="eq-virtualparticles1">
<span id="equation-eq-virtualparticles1"></span><div class="math notranslate nohighlight" id="eq-virtualparticles1">
<span id="equation-eq-virtualparticles1"></span><span class="eqno">(20)<a class="headerlink" href="#eq-virtualparticles1" title="Permalink to this equation">#</a></span>\[\vec{v}^{\mathrm{cm}}_c = \frac{1}{N_c}\left(\sum_{i=1}^{N_c} \vec{v_i} + \sum_{j=1}^{N_{\mathrm{ghost}}} \vec{v_j}^{\mathrm{ghost}} \right)\]</div>
</div>
<p>Each of these virtual particles <span class="math notranslate nohighlight">\(\vec{v_j}^{\mathrm{ghost}}\)</span> have a velocity drawn from a Maxwell Boltzmann distribution about zero with the same temperature of the fluid, <span class="math notranslate nohighlight">\(k_B T\)</span>.
Instead of determining each ghost particle’s velocity individually,
a simpler method is instead to select the entire correction <span class="math notranslate nohighlight">\(\vec{v}^{\mathrm{ghost}}\)</span>
from a Maxwell Boltzmann distribution about zero but with a variance of <span class="math notranslate nohighlight">\(N_{\mathrm{ghost}} k_B T\)</span> <a class="reference internal" href="../References/References.html#lamura2002" id="id26"><span>[Lamura2002]</span></a>.</p>
<div class="math-wrapper docutils container" id="eq-virtualparticles2">
<span id="equation-eq-virtualparticles2"></span><div class="math notranslate nohighlight" id="eq-virtualparticles2">
<span id="equation-eq-virtualparticles2"></span><span class="eqno">(21)<a class="headerlink" href="#eq-virtualparticles2" title="Permalink to this equation">#</a></span>\[\vec{v}^{\mathrm{cm}}_c = \frac{1}{N_c}\left(\sum_{i=1}^{N_c} \vec{v_i} + \vec{v}^{\mathrm{ghost}} \right)\]</div>
</div>
<p>Ghost particles are turned on for each boundary through the <code class="docutils literal notranslate"><span class="pre">phantom</span></code> tag.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;BC&quot;</span><span class="p">:</span>
    <span class="p">[</span>
        <span class="s2">&quot;phantom&quot;</span><span class="p">:</span>      <span class="mi">1</span><span class="p">,</span>          <span class="s2">&quot;this is 0 for off and 1 for on&quot;</span>
    <span class="p">]</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Ghost particles should be turned on for any solid boundary (e.g. no-slip, perfect slip).
Without it, the reduced particle density in cells leads to a lower viscosity in the proximity of walls.</p>
</div>
</section>
<section id="strong-anchoring">
<h5>Strong anchoring<a class="headerlink" href="#strong-anchoring" title="Permalink to this heading">#</a></h5>
<p>Since orientation boundary conditions are only applied to the subset of particles <span class="math notranslate nohighlight">\(N_{c*} \leq N_c\)</span> that violate the surface boundary equation <span class="math notranslate nohighlight">\(S(\vec{x})\leq0\)</span>,
the cell director <span class="math notranslate nohighlight">\(\hat{n}_c\)</span> mixes between the anchored and un-anchored orientations.
The effective anchoring strength is therefore heavily dependent on the proportion <span class="math notranslate nohighlight">\(N_{c*} / N_c\)</span>, with strongest anchoring acheived when <span class="math notranslate nohighlight">\(N_{c*} = N_c\)</span>.
To strengthen the effective anchoring, we apply the orientation boundary condition to all <span class="math notranslate nohighlight">\(N_c\)</span> particles <a class="reference internal" href="../References/References.html#head2023" id="id27"><span>[Head2023]</span></a>.</p>
<p>Strong anchoring is applied by default for solid boundaries, but requires the <code class="docutils literal notranslate"><span class="pre">phantom</span></code> tag to be turned on.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;BC&quot;</span><span class="p">:</span>
    <span class="p">[</span>
        <span class="s2">&quot;phantom&quot;</span><span class="p">:</span>      <span class="mi">1</span><span class="p">,</span>          <span class="s2">&quot;this is 0 for off and 1 for on&quot;</span>
    <span class="p">]</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="mobile-boundaries">
<h3>Mobile boundaries<a class="headerlink" href="#mobile-boundaries" title="Permalink to this heading">#</a></h3>
<section id="colloids">
<h4>Colloids<a class="headerlink" href="#colloids" title="Permalink to this heading">#</a></h4>
<p>MPCD Colloids are implemented as boundaries that are able to translate and rotate in response to interactions with the fluid.
Mobile boundaries have temporally-dependent surface parameters <span class="math notranslate nohighlight">\(\vec{Q}(t)\)</span> and <span class="math notranslate nohighlight">\(\vec{A}(t)\)</span>.
Translational and rotational motion are supported through upating <span class="math notranslate nohighlight">\(\vec{Q}(t)\)</span> and <span class="math notranslate nohighlight">\(\vec{A}(t)\)</span> using the boundary’s velocity and angular velocity properties <span class="math notranslate nohighlight">\(\vec{v}_{b}(t)\)</span> and <span class="math notranslate nohighlight">\(\vec{\omega}_{b}(t)\)</span>.</p>
<p>The boundary velocity and angular velocity each have three contributions</p>
<div class="math-wrapper docutils container" id="eq-colloidvelangvel">
<span id="equation-eq-colloidvelangvel"></span><div class="math notranslate nohighlight" id="eq-colloidvelangvel">
<span id="equation-eq-colloidvelangvel"></span><span class="eqno">(22)<a class="headerlink" href="#eq-colloidvelangvel" title="Permalink to this equation">#</a></span>\[\begin{split}\vec{v}_{b}(t) = \sum_i^{N_{c*}} \left( \Delta \vec{v}_{b,i}^{\mathrm{vel}} + \Delta \vec{v}_{b,i}^\mathrm{ori} \right) + \sum_j^{N_{col*}} \Delta \vec{v}_{b,j}^{\mathrm{col}} \\
\vec{\omega}_{b}(t) = \sum_i^{N_{c*}} \left( \Delta \vec{\omega}_{b,i}^{\mathrm{vel}} + \Delta \vec{\omega}_{b,i}^\mathrm{ori} \right) + \sum_j^{N_{col*}} \Delta \vec{\omega}_{b,j}^{\mathrm{col}}\end{split}\]</div>
</div>
<p>coming from incremental contributions due to conserving impulse and angular impulse between each of <span class="math notranslate nohighlight">\(N_{c*}\leq N\)</span> individual particles that have had applied velocity (<span class="math notranslate nohighlight">\(\mathrm{vel}\)</span>) and orientation (<span class="math notranslate nohighlight">\(\mathrm{ori}\)</span>) boundary conditions.
In addition, boundaries may move into other boundaries. For each of the <span class="math notranslate nohighlight">\(N_{col*}\)</span> overlapping boundaries, denoted by index <span class="math notranslate nohighlight">\(j\)</span>, additional boundary rules must be applied to simulate boundary-boundary interactions.
Like particles, these also enter as corrections to the boundaries <span class="math notranslate nohighlight">\(\vec{v}_{b}(t)\)</span> and <span class="math notranslate nohighlight">\(\vec{\omega}_{b}(t)\)</span>, through increments denoted by (<span class="math notranslate nohighlight">\(\mathrm{col}\)</span>).
Colloid-colloid interactions are treated as elastic collisions.</p>
<p>Boundaries are enabled to be mobile by setting <code class="docutils literal notranslate"><span class="pre">&quot;dsplc&quot;</span> <span class="pre">=</span> <span class="pre">1</span></code> in the boundary input.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;BC&quot;</span><span class="p">:</span>
    <span class="p">[</span>
        <span class="s2">&quot;dsplc&quot;</span><span class="p">:</span>    <span class="mi">1</span><span class="p">,</span>
    <span class="p">]</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The current version only support mobile spherical colloids where <span class="math notranslate nohighlight">\(\vec{A}(t) = \vec{A}(0)\)</span>.</p>
</div>
<section id="motion-from-velocity-rules">
<h5>Motion from velocity rules<a class="headerlink" href="#motion-from-velocity-rules" title="Permalink to this heading">#</a></h5>
<p>When <a class="reference internal" href="#subsection-boundaryrules"><span class="std std-ref">boundary rules</span></a> are applied to a particle, the velocity can be updated through the velocity shift <span class="math notranslate nohighlight">\(D_{v,\hat{\nu}}\)</span> and multiplier operators <span class="math notranslate nohighlight">\(M_{v,\hat{\nu}}\)</span> in the directions specified by <span class="math notranslate nohighlight">\(\hat{\nu}\)</span> — corresponding to a change in the particle’s momentum (if any <span class="math notranslate nohighlight">\(M_{v,\hat{\nu}}\neq 1\)</span> or <span class="math notranslate nohighlight">\(D_{v,\hat{\nu}}\neq 0\)</span>).
The change of momentum of the particle over the time-step interval <span class="math notranslate nohighlight">\(\delta t\)</span> can be written in terms of the particle impulse <span class="math notranslate nohighlight">\(\vec{J}_i\)</span></p>
<div class="math-wrapper docutils container" id="eq-impulse">
<span id="equation-eq-impulse"></span><div class="math notranslate nohighlight" id="eq-impulse">
<span id="equation-eq-impulse"></span><span class="eqno">(23)<a class="headerlink" href="#eq-impulse" title="Permalink to this equation">#</a></span>\[\vec{p}_i(t+\delta t) - \vec{p}_i(t) = \vec{J}_i.\]</div>
</div>
<p>If the boundary is static, then the impulse is absorbed by the boundary. However,
if the boundary is mobile, then we assume impulse conservation between the particle and boundary, <span class="math notranslate nohighlight">\(\vec{J}_i+\vec{J}_b=0\)</span>.
Where <span class="math notranslate nohighlight">\(b\)</span> denotes the boundary index.</p>
<p>In satisfying the impulse conservation, the correction to the colloid’s velocity and angular velocity, due to the applied velocity boundary rules on particle <span class="math notranslate nohighlight">\(i\)</span>, is</p>
<div class="math-wrapper docutils container" id="eq-impulsetocolloid">
<span id="equation-eq-impulsetocolloid"></span><div class="math notranslate nohighlight" id="eq-impulsetocolloid">
<span id="equation-eq-impulsetocolloid"></span><span class="eqno">(24)<a class="headerlink" href="#eq-impulsetocolloid" title="Permalink to this equation">#</a></span>\[\begin{split}\Delta \vec{v}_{b,i}^{\mathrm{vel}} = I_b^{-1}\vec{J}_{b,\hat{n}} \\
\Delta \vec{\omega}_{b,i}^{\mathrm{vel}} = \vec{r}\times(I_b^{-1}\vec{J}_{b,\hat{t}})\end{split}\]</div>
</div>
<p>where <span class="math notranslate nohighlight">\(\vec{J}_{b,\hat{n}}=(\vec{J}_b\cdot\hat{n})\hat{n}\)</span> is the normal component and <span class="math notranslate nohighlight">\(\vec{J}_{b,\hat{t}}=\vec{J}_b-(\vec{J}_b\cdot\hat{n})\hat{n}\)</span> is the tangential component of the impulse.
The inverse of the moment of inertia tensor is <span class="math notranslate nohighlight">\(I_b^{-1}\)</span>. The vector from the centre of mass to the collision on the wall is <span class="math notranslate nohighlight">\(\vec{r}\)</span>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The current version only support mobile spherical colloids where the local
surface normal and tangent projections of the impulse are sufficient for separating translational and rotational motion.</p>
</div>
</section>
<section id="motion-from-orientation-rules">
<h5>Motion from orientation rules<a class="headerlink" href="#motion-from-orientation-rules" title="Permalink to this heading">#</a></h5>
<p>The particle-boundary interactions can update the particle orientation through the multiplier operations <span class="math notranslate nohighlight">\(M_{u,\hat{\nu}}\)</span> in the directions specified by <span class="math notranslate nohighlight">\(\hat{\nu}\)</span>.
The reorientation of particle <span class="math notranslate nohighlight">\(i\)</span> corresponds to a rotational impulse <span class="math notranslate nohighlight">\(\vec{\mathcal{T}}_i\)</span> due to a change in angular momentum over time interval <span class="math notranslate nohighlight">\(\delta t\)</span>.</p>
<div class="math-wrapper docutils container" id="eq-angularimpulse">
<span id="equation-eq-angularimpulse"></span><div class="math notranslate nohighlight" id="eq-angularimpulse">
<span id="equation-eq-angularimpulse"></span><span class="eqno">(25)<a class="headerlink" href="#eq-angularimpulse" title="Permalink to this equation">#</a></span>\[\vec{\omega}_i(t+\delta t) - \vec{\omega}_i(t) = \vec{\mathcal{T}}_i.\]</div>
</div>
<p>The equation has a pivot point defined at the particle position on the boundary.</p>
<p>Similar to the velocity rules, if the boundary is static, then the rotational impulse is absorbed by the boundary.
However, if the boundary is mobile, then we assume rotational impulse conservation between the particle and boundary.
It is the rotational impulse that needs to be converted into boundary increments <span class="math notranslate nohighlight">\(\Delta \vec{v}_{b,i}^\mathrm{ori}\)</span> and <span class="math notranslate nohighlight">\(\Delta \vec{\omega}_{b,i}^\mathrm{ori}\)</span> <a class="reference internal" href="../References/References.html#head2023" id="id28"><span>[Head2023]</span></a>.</p>
<p>For our mobile colloid, <a class="reference internal" href="#eq-angularimpulse"><span class="std std-ref">rotational impulse conservation</span></a> can be recast into a torque balance, through <span class="math notranslate nohighlight">\(\vec{\mathcal{T}}_i=\vec{\Gamma}_i \delta t\)</span></p>
<div class="math-wrapper docutils container" id="eq-torqueconservation">
<span id="equation-eq-torqueconservation"></span><div class="math notranslate nohighlight" id="eq-torqueconservation">
<span id="equation-eq-torqueconservation"></span><span class="eqno">(26)<a class="headerlink" href="#eq-torqueconservation" title="Permalink to this equation">#</a></span>\[\vec{\Gamma}_i + \vec{\Gamma}_{b,i} = 0\]</div>
</div>
<p>where <span class="math notranslate nohighlight">\(\vec{\Gamma}_{b,i}\)</span> is the torque that is transferred to the colloid at the position of particle <span class="math notranslate nohighlight">\(i\)</span>.</p>
<p>For a particle with initial orientation <span class="math notranslate nohighlight">\(\hat{u}_i\)</span> with an anchoring axis <span class="math notranslate nohighlight">\(\hat{\nu}\)</span>, the torque on the particle takes the form</p>
<div class="math-wrapper docutils container" id="eq-impulse3">
<span id="equation-eq-impulse3"></span><div class="math notranslate nohighlight" id="eq-impulse3">
<span id="equation-eq-impulse3"></span><span class="eqno">(27)<a class="headerlink" href="#eq-impulse3" title="Permalink to this equation">#</a></span>\[\vec{\Gamma}_i = \frac{\gamma_R}{\ell_u \delta t} \frac{M_{\nu}-M_{\perp}}{\sqrt{M_\nu^2 + M_\perp^2}}\left(\hat{u}_i \cdot \hat{\nu} \right)\left( \hat{u}_i \times \hat{\nu} \right)\]</div>
</div>
<p>with <span class="math notranslate nohighlight">\(\frac{M_{\nu}-M_{\perp}}{\sqrt{M_\nu^2 + M_\perp^2}}=1\)</span> when anchoring is fixed along <span class="math notranslate nohighlight">\(\hat{\nu}\)</span> using <span class="math notranslate nohighlight">\(M_{\nu}=1\)</span> and <span class="math notranslate nohighlight">\(M_{\perp}=0\)</span> (the multiplier perpendicular to <span class="math notranslate nohighlight">\(M_{\nu}\)</span>).</p>
<p>The torque is only dependent on fixed simulation parameters and the relative alignment of <span class="math notranslate nohighlight">\(\hat{u}_i\)</span> and <span class="math notranslate nohighlight">\(\hat{\nu}\)</span>.
Defining the alignment as <span class="math notranslate nohighlight">\(\cos\theta_i = \hat{u}_i\cdot \hat{\nu}\)</span>, the torque <span class="math notranslate nohighlight">\(\Gamma_i = \frac{\gamma_R}{\ell_u \delta t} \sin 2\theta\)</span>.
The torque is odd under <span class="math notranslate nohighlight">\(\Gamma_i(-\theta)=-\Gamma_i(\theta)\)</span>,
which motivates that the torque transferred to the colloid can be treated as a virtual MPCD particle at the same point,
oriented in the direction <span class="math notranslate nohighlight">\(\hat{u}_{b,i}\)</span> that has angle <span class="math notranslate nohighlight">\(-\theta\)</span> relative to <span class="math notranslate nohighlight">\(\hat{\nu}\)</span>, and rotates in the opposite sense to <span class="math notranslate nohighlight">\(\hat{u}_i\)</span>.
This construction satisfies the <a class="reference internal" href="#eq-torqueconservation"><span class="std std-ref">torque conservation equation</span></a>.</p>
<p>The torque <span class="math notranslate nohighlight">\(\vec{\Gamma}_{b,i}\)</span> on the virtual particle, is converted into a force at the colloidal boundary by,</p>
<div class="math-wrapper docutils container" id="eq-force">
<span id="equation-eq-force"></span><div class="math notranslate nohighlight" id="eq-force">
<span id="equation-eq-force"></span><span class="eqno">(28)<a class="headerlink" href="#eq-force" title="Permalink to this equation">#</a></span>\[\vec{F}_{b,i} = \frac{\vec{\Gamma}_{b,i} \times \hat{u}_{b,i}}{\ell_u}\]</div>
</div>
<p>where the above is only valid with the assumption <span class="math notranslate nohighlight">\(\hat{u}_{b,i}\)</span> and <span class="math notranslate nohighlight">\(\vec{F}_{b,i}\)</span> are orthogonal.
The parameter <span class="math notranslate nohighlight">\(\ell_u\)</span> has units of length, and is the effective length of the rod <code class="docutils literal notranslate"><span class="pre">len</span></code>.
This assumption is motivated by the anchoring reorientation being purely rotational motion around the pivot point, and hence no colinear contributions between the force and orientation <span class="math notranslate nohighlight">\(\hat{u}_{b,i}\cdot\hat{F}_{b,i} = 0\)</span>.</p>
<p>Since the orientation <span class="math notranslate nohighlight">\(\hat{u}_{b,i}\)</span> is head-tail symmetric, the force has an ambiguous sign under <span class="math notranslate nohighlight">\(\vec{F}(-\hat{u}_{b,i})=-\vec{F}(\hat{u}_{b,i})\)</span>.
For this reason, the force is chosen to be oriented into the boundary, motivated by nematic colloids moving away from large elastic stress in reducing elastic deformation.</p>
<p>The increments to the colloid’s velocity and angular velocity are</p>
<div class="math-wrapper docutils container" id="eq-incrementcolloid">
<span id="equation-eq-incrementcolloid"></span><div class="math notranslate nohighlight" id="eq-incrementcolloid">
<span id="equation-eq-incrementcolloid"></span><span class="eqno">(29)<a class="headerlink" href="#eq-incrementcolloid" title="Permalink to this equation">#</a></span>\[\begin{split}\Delta \vec{v}_{b,i}^{\mathrm{ori}} = I_b^{-1} \vec{F}_{b,\hat{n}}\delta t \\
\Delta \vec{\omega}_{b,i}^{\mathrm{ori}} =  \vec{r}\times (I_b^{-1}\vec{F}_{b,\hat{t}}\delta t)\end{split}\]</div>
</div>
<p>where the vector from the centre of mass to the collision on the wall is <span class="math notranslate nohighlight">\(\vec{r}\)</span>,
<span class="math notranslate nohighlight">\(\vec{F}_{b,\hat{n}}=(\vec{F}_b\cdot\hat{n})\hat{n}\)</span> is the normal component and <span class="math notranslate nohighlight">\(\vec{F}_{b,\hat{t}}=\vec{F}_b-(\vec{F}_b\cdot\hat{n})\hat{n}\)</span> is the tangential component the force.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The current version only support mobile spherical colloids with homeotropic anchoring (<span class="math notranslate nohighlight">\(\hat{\nu}=\hat{n}\)</span>)</p>
</div>
</section>
</section>
</section>
<section id="liquids-inside-or-outside-boundaries">
<h3>Liquids inside or outside boundaries<a class="headerlink" href="#liquids-inside-or-outside-boundaries" title="Permalink to this heading">#</a></h3>
<p>We can not only have partcies/liquids inside closed system. Like we have a 2D square system with absolute solid walls</p>
<img alt="../_images/BC_classic.jpg" src="../_images/BC_classic.jpg" />
<p>But the boudaries also can be movable and interact with other boundaries and particles/liquids in the system.
The ones which are solid</p>
<img alt="../_images/BC_another_bc_inside.jpg" src="../_images/BC_another_bc_inside.jpg" />
<p>Teh example configuration for this boundary looks like this</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;BC&quot;</span><span class="p">:</span>
    <span class="p">[</span>
        <span class="s2">&quot;inv&quot;</span><span class="p">:</span>      <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;A&quot;</span><span class="p">:</span>        <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
        <span class="s2">&quot;P&quot;</span><span class="p">:</span>        <span class="mi">4</span><span class="p">,</span>
        <span class="s2">&quot;Q&quot;</span><span class="p">:</span>        <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span>
        <span class="s2">&quot;R&quot;</span><span class="p">:</span>        <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;dsplc&quot;</span><span class="p">:</span>    <span class="mi">1</span><span class="p">,</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>inv parameter is necessary there, 0 indicates that particles should move outside the obstacle in the initialization. Dsplc parameter indicates that obstacle can be moved.</p>
<p>And the ones which can have particles/liquid inside.
If we want the liquid to be inside the obstacle we should set inv paramter to 1 can set species distribution to be inside the obstacle. An example configuration for it</p>
<img alt="../_images/BC_another_bc_filled.jpg" src="../_images/BC_another_bc_filled.jpg" />
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;species&quot;</span><span class="p">:</span>
    <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;dens&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
            <span class="s2">&quot;mass&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;qDist&quot;</span><span class="p">:</span> <span class="mi">2</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="s2">&quot;BC&quot;</span><span class="p">:</span>
    <span class="p">[</span>
        <span class="s2">&quot;inv&quot;</span><span class="p">:</span>      <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;A&quot;</span><span class="p">:</span>        <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
        <span class="s2">&quot;P&quot;</span><span class="p">:</span>        <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>
        <span class="s2">&quot;Q&quot;</span><span class="p">:</span>        <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span>
        <span class="s2">&quot;R&quot;</span><span class="p">:</span>        <span class="mi">10</span><span class="p">,</span>
        <span class="s2">&quot;dsplc&quot;</span><span class="p">:</span>    <span class="mi">1</span><span class="p">,</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>The inv 1 will make sure that particles will be inside our obstacle and qDist 2 will place all particles in the center of control volume.</p>
</section>
<section id="other">
<h3>Other<a class="headerlink" href="#other" title="Permalink to this heading">#</a></h3>
<section id="thermal-boundary-conditions">
<span id="thermalbcs"></span><h4>Thermal boundary conditions<a class="headerlink" href="#thermal-boundary-conditions" title="Permalink to this heading">#</a></h4>
<p>MPCD boundaries are able interact with the particles in natural physical way.
Depending on the collision type of the boundary</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&quot;BC&quot;:</span>
<span class="go">[</span>
<span class="go">    {</span>
<span class="go">        &quot;colType&quot;:</span>
<span class="go">    }</span>
<span class="go">]</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">colType</span><span class="p">:</span>
<span class="mi">0</span> <span class="o">-</span> <span class="n">Respects</span> <span class="nb">all</span> <span class="n">conservation</span> <span class="n">laws</span> <span class="n">by</span> <span class="n">impact</span> <span class="n">analysis</span><span class="o">.</span>
<span class="mi">1</span> <span class="o">-</span> <span class="n">Rule</span> <span class="n">based</span> <span class="n">collisions</span> <span class="n">at</span> <span class="n">the</span> <span class="n">surface</span><span class="o">.</span>
<span class="mi">2</span> <span class="o">-</span> <span class="n">Probabilistic</span> <span class="n">reflections</span> <span class="n">at</span> <span class="n">the</span> <span class="n">surface</span><span class="o">.</span>
</pre></div>
</div>
<p>If we have collision type 2 for boundaries - particles will draw random velocities from a thermal distribution.
All the interactions are based on KBT value. Tangential value of the velocity of the particle is being drawn from Maxwell-Boltzmann distribution.
And the normal value is being drawn from Rayleigh distribution.</p>
</section>
</section>
</section>
<section id="extra-options">
<span id="extraschapter"></span><h2>Extra options<a class="headerlink" href="#extra-options" title="Permalink to this heading">#</a></h2>
<section id="zeroing-the-net-momentum">
<span id="zeromom"></span><h3>Zeroing the net momentum<a class="headerlink" href="#zeroing-the-net-momentum" title="Permalink to this heading">#</a></h3>
<p>Many of the initialization routines assign <a class="reference internal" href="#velocity"><span class="std std-ref">stochastic values to the particle velocities</span></a>. To identically zero the system’s net momentum after initialization, turn it on in your input <code class="docutils literal notranslate"><span class="pre">.json</span></code> file by setting:</p>
<blockquote>
<div><div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;rFrame&quot;</span><span class="p">:</span><span class="w">         </span><span class="mi">1</span><span class="p">,</span>
</pre></div>
</div>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The default value is 0 (off).</p>
</div>
<p>Similarly, the system-wide net momentum can be zeroed any number of time steps. This will destroy any net flow but may be desirable in some situations. Set the zeroing time in your input <code class="docutils literal notranslate"><span class="pre">.json</span></code> file by:</p>
<blockquote>
<div><div class="highlight-json notranslate"><div class="highlight"><pre><span></span>&quot;zeroNetMom&quot;:        &lt;value&gt;,
</pre></div>
</div>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The default value is 0 (off). Setting 1 will zero the net momentum every timestep, while 42 will zero the net momentum every 42 timesteps.</p>
</div>
</section>
<section id="turn-off-hydrodynamics">
<span id="nohi"></span><h3>Turn-off hydrodynamics<a class="headerlink" href="#turn-off-hydrodynamics" title="Permalink to this heading">#</a></h3>
<p>Hydrodynamics can be turned off, which essentially creates a Langenvin dynamics simulation with a computationally costly Brownian thermostat.
Though computationally costly, the benefit is that the material properties of the fluid are preserved.
By turning them off, the role of hydrodynamic interactions can be probed.</p>
<p>Hydrodynamic interactions are turned off by randomly exchanging the velocity of all fluid particles after  the collision collision step <a class="reference internal" href="../References/References.html#ali2004" id="id29"><span>[Ali2004]</span></a>.</p>
<p>To turn off hydrodynamic interactions, add the following to your input <code class="docutils literal notranslate"><span class="pre">.json</span></code> file:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&quot;noHI&quot;:         1,</span>
</pre></div>
</div>
<figure class="align-center" id="id32">
<a class="reference internal image-reference" href="../_images/brownian.png"><img alt="Logo" src="../_images/brownian.png" style="width: 369.3px; height: 354.59999999999997px;" /></a>
<figcaption>
<p><span class="caption-text">Hydrodynamic interactions are “scrambled” by randomly exchange particle velocities.</span><a class="headerlink" href="#id32" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>If on the other hand a friction acts on the fluid (like a Brinkman term) (rather than ignoring hydrodynamic interactions), this can be set as a <a class="reference internal" href="#damping"><span class="std std-ref">damping friction coefficient</span></a>.</p>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../HardCoded/HardCoded.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Hard-coded options</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../Tutorials/Tutorials.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Tutorials</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023, Shendruk Lab
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Usage</a><ul>
<li><a class="reference internal" href="#system-properties">System properties</a><ul>
<li><a class="reference internal" href="#domain">Domain</a></li>
<li><a class="reference internal" href="#thermal-energy">Thermal energy</a></li>
<li><a class="reference internal" href="#timestep">Timestep</a></li>
<li><a class="reference internal" href="#simulation-steps">Simulation steps</a></li>
<li><a class="reference internal" href="#warmup-steps">Warmup steps</a></li>
<li><a class="reference internal" href="#random-number-seed">Random number seed</a></li>
<li><a class="reference internal" href="#terminal-output">Terminal output</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mpcd-particle-properties">MPCD particle properties</a><ul>
<li><a class="reference internal" href="#isotropic-fluid">Isotropic fluid</a><ul>
<li><a class="reference internal" href="#position">Position</a></li>
<li><a class="reference internal" href="#velocity">Velocity</a></li>
<li><a class="reference internal" href="#mass">Mass</a></li>
<li><a class="reference internal" href="#population">Population</a></li>
<li><a class="reference internal" href="#number-density">Number density</a></li>
</ul>
</li>
<li><a class="reference internal" href="#nematic-fluid">Nematic fluid</a><ul>
<li><a class="reference internal" href="#orientation">Orientation</a></li>
<li><a class="reference internal" href="#rotational-friction-coefficient">Rotational friction coefficient</a></li>
<li><a class="reference internal" href="#tumbling-parameter">Tumbling parameter</a></li>
<li><a class="reference internal" href="#shear-susceptibility">Shear susceptibility</a></li>
<li><a class="reference internal" href="#magnetic-susceptibility">Magnetic susceptibility</a></li>
<li><a class="reference internal" href="#length">Length</a></li>
</ul>
</li>
<li><a class="reference internal" href="#active-fluid">Active fluid</a><ul>
<li><a class="reference internal" href="#active-nematic">Active nematic</a></li>
<li><a class="reference internal" href="#active-polar">Active polar</a></li>
</ul>
</li>
<li><a class="reference internal" href="#multiphase">Multiphase</a><ul>
<li><a class="reference internal" href="#interaction-matrix">Interaction matrix</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#mpcd-cell-properties">MPCD cell properties</a><ul>
<li><a class="reference internal" href="#cell-size">Cell size</a></li>
<li><a class="reference internal" href="#numberincell">Number density</a></li>
<li><a class="reference internal" href="#center-of-mass-velocity">Center of mass velocity</a></li>
<li><a class="reference internal" href="#center-of-mass">Center of mass</a></li>
<li><a class="reference internal" href="#moment-of-inertia">Moment of inertia</a></li>
<li><a class="reference internal" href="#nematic-order">Nematic order</a></li>
<li><a class="reference internal" href="#local-velocity-gradient-tensor">Local velocity gradient tensor</a></li>
<li><a class="reference internal" href="#galilean-invariance">Galilean invariance</a></li>
<li><a class="reference internal" href="#thermostats">Thermostats</a></li>
</ul>
</li>
<li><a class="reference internal" href="#collision-operators">Collision operators</a><ul>
<li><a class="reference internal" href="#stochastic-rotation-dynamics">Stochastic rotation dynamics</a></li>
<li><a class="reference internal" href="#andersen-thermostatted-mpcd">Andersen-thermostatted MPCD</a></li>
<li><a class="reference internal" href="#conservation-of-angular-momentum">Conservation of angular momentum</a></li>
<li><a class="reference internal" href="#nematic-mpcd">Nematic MPCD</a></li>
<li><a class="reference internal" href="#active-nematic-mpcd">Active-Nematic MPCD</a><ul>
<li><a class="reference internal" href="#local-activity-modulators">Local activity modulators</a></li>
<li><a class="reference internal" href="#ratio-of-active-particles">Ratio of active particles</a></li>
</ul>
</li>
<li><a class="reference internal" href="#active-polar-mpcd">Active-Polar MPCD</a></li>
<li><a class="reference internal" href="#id21">Active-Polar MPCD</a></li>
<li><a class="reference internal" href="#gravitational-acceleration">Gravitational acceleration</a></li>
<li><a class="reference internal" href="#magnetic-field">Magnetic field</a></li>
<li><a class="reference internal" href="#friction-coefficient">Friction coefficient</a></li>
</ul>
</li>
<li><a class="reference internal" href="#boundary-conditions">Boundary conditions</a><ul>
<li><a class="reference internal" href="#surfaces">Surfaces</a><ul>
<li><a class="reference internal" href="#standard-surfaces">Standard surfaces</a></li>
<li><a class="reference internal" href="#additional-surface-forms">Additional surface forms</a><ul>
<li><a class="reference internal" href="#wavy-surfaces">Wavy surfaces</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#boundary-rules">Boundary rules</a><ul>
<li><a class="reference internal" href="#requirements">Requirements</a></li>
<li><a class="reference internal" href="#boundary-operators">Boundary operators</a><ul>
<li><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#boundary-corrections">Boundary corrections</a><ul>
<li><a class="reference internal" href="#ghost-particles">Ghost particles</a></li>
<li><a class="reference internal" href="#strong-anchoring">Strong anchoring</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#mobile-boundaries">Mobile boundaries</a><ul>
<li><a class="reference internal" href="#colloids">Colloids</a><ul>
<li><a class="reference internal" href="#motion-from-velocity-rules">Motion from velocity rules</a></li>
<li><a class="reference internal" href="#motion-from-orientation-rules">Motion from orientation rules</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#liquids-inside-or-outside-boundaries">Liquids inside or outside boundaries</a></li>
<li><a class="reference internal" href="#other">Other</a><ul>
<li><a class="reference internal" href="#thermal-boundary-conditions">Thermal boundary conditions</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#extra-options">Extra options</a><ul>
<li><a class="reference internal" href="#zeroing-the-net-momentum">Zeroing the net momentum</a></li>
<li><a class="reference internal" href="#turn-off-hydrodynamics">Turn-off hydrodynamics</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>